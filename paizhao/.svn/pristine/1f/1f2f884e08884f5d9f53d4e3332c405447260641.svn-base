define("wap-huipai:global/utility/cross_domain_storage",function(){function e(e,t){var n=null,i=!1,r=e,d=t,o=[],a={},u=0,s=function(){try{return window.postMessage&&window.JSON&&"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),f=function(e){n&&(a[e.request.id]=e,n.contentWindow.postMessage(JSON.stringify(e.request),r))},c=function(){if(i=!0,o.length){for(var e=0,t=o.length;t>e;e++)f(o[e]);o=[]}},l=function(e){if(e.origin==r){var t=JSON.parse(e.data);"undefined"!=typeof a[t.id].deferred&&a[t.id].deferred.resolve(t.value),"function"==typeof a[t.id].callback&&a[t.id].callback(t.key,t.value),delete a[t.id]}};this.getItem=function(e,t){if(s){var n={id:++u,type:"get",key:e},r={request:n,callback:t};if(window.jQuery&&(r.deferred=jQuery.Deferred()),i?f(r):o.push(r),window.jQuery)return r.deferred.promise()}},this.setItem=function(e,t){if(s){var n={id:++u,type:"set",key:e,value:t},r={request:n};if(window.jQuery&&(r.deferred=jQuery.Deferred()),i?f(r):o.push(r),window.jQuery)return r.deferred.promise()}},!n&&s&&(n=document.createElement("iframe"),n.style.cssText="position:absolute;width:1px;height:1px;left:-9999px;",document.body.appendChild(n),window.addEventListener?(n.addEventListener("load",function(){c()},!1),window.addEventListener("message",function(e){l(e)},!1)):n.attachEvent&&(n.attachEvent("onload",function(){c()},!1),window.attachEvent("onmessage",function(e){l(e)})),n.src=r+d)}return e});