define("pc-huipai:global/list/list",function(e){function a(e){var a=this,e=e||{};a.$render_ele=e.ele||{},a.send_url=e.url||"",a.ajax_params=e.params||{},a.ajax_type=e.ajax_type||"GET",a.template=e.template||{},a.is_open_lazyload=null==e.is_open_lazyload?!0:!1,a.is_open_lz_opts=e.is_open_lz_opts||"",a.show_no_data_tips=e.show_no_data_tips||!1,a.list_extend_opts=e.list_extend_opts||[],a.init(e)}var n=e("pc-huipai:global/utility/index"),t=e("../widget/abnormal/index"),i=e("pc-huipai:global/lazyload/lazyload"),r=$({});return a.prototype={refresh:function(e){var a=this;e&&(a.ajax_params=$.extend(a.ajax_params,e)),a.page=1,a.action(a.page)},load_more:function(){var e=this;e._sending||(e.has_next_page?(e.page++,e.action(e.page)):e.$load_more.html("到底部了"))},init:function(){var e=this;r.$loading={},e.page=1,e.$render_ele.append('<div data-role="list"></div>'),e.$render_ele.append('<div class="" data-role="abnormal"></div>'),e.$render_ele.append('<div class="ui-list-load-more-btn fn-hide" data-role="load_more">正在加载...</div>'),e.$list_container=e.$render_ele.find('[data-role="list"]'),e.$abnormal=e.$render_ele.find('[data-role="abnormal"]'),e.$load_more=e.$render_ele.find('[data-role="load_more"]'),e.$el=e.$render_ele,e.refresh(),e.window_scroll_more()},action:function(e){var a=this;a._sending||(a.ajax_params=$.extend(a.ajax_params,{page:e}),r.ajax_obj=n.ajax_request({url:a.send_url,data:a.ajax_params,type:a.ajax_type,beforeSend:function(){a._sending=!0,r.$loading=$.loading({content:"加载中..."})},success:function(n){console.log(n),a._sending=!1;var i=n.result_data.list;if(a.$el.rq_status="success",a.$el.trigger("list_render:before",[a.$list_container,n]),r.$loading.loading("hide"),a.has_next_page=n.result_data.has_next_page,!i.length&&1==e)return t.render(a.$abnormal[0],{message:a.show_no_data_tips}),a.$abnormal.removeClass("fn-hide"),a.$list_container.addClass("fn-hide"),a.$load_more.addClass("fn-hide"),void a.$el.trigger("list_render:after",[a.$list_container,n,$(_)]);a.$abnormal.addClass("fn-hide"),a.$list_container.removeClass("fn-hide"),a.$load_more.removeClass("fn-hide");for(var l=a.list_extend_opts,o={list:i},s=0;s<l.length;s++)if("string"==typeof l[s]){var d=l[s];n.result_data[d]&&(o[d]=n.result_data[d])}var _=a.template(o);1==e?a.$list_container.html(_):a.$list_container.append(_),a.$el.trigger("list_render:after",[a.$list_container,n,$(_)]),a.setup_event()},error:function(){a._sending=!1,r.$loading.loading("hide"),$.tips({content:"网络异常",stayTime:3e3,type:"warn"}),a.$el.trigger("request:error"),a.$el.rq_status="error"}}))},window_scroll_more:function(){var e=this;$(window).scroll(function(){e.$list_container.height()&&$(window).scrollTop()+$(window).height()>$(document).height()-50&&e.load_more()})},setup_event:function(){var e=this;if(e.is_open_lazyload)if(e.lazyloading)e.lazyloading.refresh();else{var a={size:window.innerWidth};e.is_open_lz_opts||(a={}),e.lazyloading=new i($("body"),a)}e.$render_ele.height()<window.innerHeight&&e.$load_more.addClass("fn-hide")}},a});