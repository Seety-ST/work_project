define("wap-huipai:global/location_sel/location_localstorage",function(a,t,o){function e(a){var t=this,a=a||{};return t.list_type=a.list_type||"list",t.$province_data=a.$province_data||$("[data-role='province-data']"),t.$city_data=a.$city_data||$("[data-role='city-data']"),t.$common_data=a.$common_data||$("[common-data-role='common-data']"),t.$province_data_text=a.$province_data_text||$("[data-role='province-data-text']"),t.$city_data_text=a.$city_data_text||$("[data-role='city-data-text']"),t.$province_data_list=a.$province_data_list||$("[data-role='province-data-list']"),t.$city_data_list=a.$city_data_list||$("[data-role='city-data-list']"),t.$province_data_list_wrap=a.$province_data_list_wrap||$("[data-role='province-data-list-wrap']"),t.$city_data_list_wrap=a.$city_data_list_wrap||$("[data-role='city-data-list-wrap']"),t.$common_data_list_wrap=a.$common_data_list_wrap||$("[common-data-role='common-data-list-wrap']"),t.$reset_btn=a.$reset_btn||$("[data-role='reset']"),t.lid=a.lid,t.version=a.version||"1.0.0",t.$common_data_list=a.$common_data_list||$("[common-data-role='common-data-list']"),t.province_id=a.province_id||"0",t.city_id=a.city_id||"0",t.province_obj={},t.city_obj={},t.location_module_offset_top=t.$common_data.offset().top,t.init(a),t}if(!$)return void alert("缺少Jquery或者Zepto脚本，请先引用");var i=window.localStorage,c={storage:{prefix:"poco-paizhao-app-",set:function(a,t){try{return i&&"undefined"!=typeof i?"undefined"==typeof t?c.storage.remove(a):(i.setItem(c.storage.prefix+a,JSON.stringify(t)),t):!1}catch(o){return console.warn(o),!1}},get:function(a){try{var t=i.getItem(c.storage.prefix+a);return t?JSON.parse(t):t}catch(o){return console.warn(o),!1}},remove:function(a){return i.removeItem(c.storage.prefix+a)}},ajax_request:function(a){var a=a||{},t=a.url,o=a.data||{},e=a.cache||!1,i=a.beforeSend||function(){},c=a.success||function(){},r=a.error||function(){},n=a.complete||function(){},l=a.type||"GET",s=a.dataType||"json",_=null==a.async?!0:!1,d=$.ajax({url:t,type:l,data:o,cache:e,async:_,dataType:s,beforeSend:i,success:c,error:r,complete:n});return d=$.extend(d,{xhr_data:o}),console.log(_),d}};e.prototype={init:function(){var a=this;return a.refresh(),a},data_init_callback:function(){var a=this,t=a.province_id,o=a.city_id;a._render_tab_list("province","0",t),a._render_tab_list("city",t,o),a._render_list("province","0"),a._render_list("city",t),a._event_bind()},refresh:function(){var a=this,t=c.storage.get("paizhao_location_data_version")||"";if(console.log(t),t)if(a.version!==t)a.action();else{var o=c.storage.get("paizhao_location_data");a.province_obj=JSON.parse(o.province),a.city_obj=JSON.parse(o.city),a.data_init_callback(),console.log("调用local了一次")}else a.action()},action:function(){var a=this,t=1e4,o=!1,e="../ajax/search/get_location_data.php";c.ajax_request({url:e,dataType:"JSON",timeout:t,cache:!0,beforeSend:function(){},success:function(t){o=!0,console.log(typeof t);var t=JSON.parse(t);console.log(t);var e=t.result_data;console.log(e),a.version=e.version,c.storage.set("paizhao_location_data",e),c.storage.set("paizhao_location_data_version",a.version),a.province_obj=JSON.parse(e.province),a.city_obj=JSON.parse(e.city),a.data_init_callback(),console.log("调用ajax了一次")}}),window.setTimeout(function(){if(!o){var t='<div class="tc mt10">网络异常，请点击刷新</div>';a.$province_data_list.html(t)}},t)},_get_list_obj_by_id:function(a,t){var o=this,e=o.province_obj,i=o.city_obj;switch(a){case"province":var c=e;break;case"city":var c=i}var r=[],n=c.length;console.log(a+"get_list:"+n);for(var l=0,s=0;n>s;s++)c[s].parent_id==t&&(r[l]=c[s],l++);return c=r},_get_location_name_by_id:function(a,t,o){var e=this,i=e._get_list_obj_by_id(a,t);console.log("parent_location_id:"+t),console.log(i);var c="";if(0==o)switch(a){case"province":c="请选择省";break;case"city":c=c="请选择城市"}else if(i)if(""!=o){for(var r=i.length,n=0;r>n;n++)if(o==i[n].location_id){c=i[n].location_name;break}}else c="请选择城市";return console.log(c),c},_render_list:function(a,t){var o=this,e=o.province_id,i=o.city_id,c=o._get_list_obj_by_id(a,t),r="<ul>",n="</ul>",l="";if(c)for(var s=c.length,_=0;s>_;_++)switch(a){case"province":l+=e==c[_].location_id?'<li class="li-cur" data-role="province-detail" data-id="'+c[_].location_id+'">'+c[_].location_name+"</li>":'<li data-role="province-detail" data-id="'+c[_].location_id+'">'+c[_].location_name+"</li>";break;case"city":l+=i==c[_].location_id?'<li class="li-cur" data-role="city-detail" data-id="'+c[_].location_id+'">'+c[_].location_name+"</li>":'<li data-role="city-detail" data-id="'+c[_].location_id+'">'+c[_].location_name+"</li>"}var d=r+l+n;switch(a){case"province":o.$province_data_list.html(d);break;case"city":o.$city_data_list.html(d)}},_render_tab_list:function(a,t,o){var e=this,i="",c="",r="",n=e.$province_data,l=e.$city_data,s=e.$province_data_text,_=e.$city_data_text,d=e.$province_data_list_wrap,p=e.$city_data_list_wrap;switch(a){case"province":r=e._get_location_name_by_id("province",t,o),i=r,c="请选择城市",s.html(i),_.html(c),d.removeClass("dn"),p.hasClass("dn")||p.addClass("dn");break;case"city":r=e._get_location_name_by_id("city",t,o),"0"!=o&&(n.removeClass("sel-cur"),c=r,l.addClass("sel-cur"),_.html(c),d.hasClass("dn")||d.addClass("dn"),p.removeClass("dn"))}},_event_bind:function(){var a=this,t=a.$common_data,o=a.$common_data_list,e=a.$common_data_list_wrap,i=a.$reset_btn;o.on("click",function(t){var o=t.target,e=$(o).attr("data-role"),i=$(o).attr("data-id");console.log("点击了列表"),console.log("data_role=:"+e),console.log("data_id=:"+i),"province-detail"==e?(console.log("省列表点击"),a._render_tab_list("province","0",i),a._render_tab_list("city",i,""),a._render_list("city",i),$("[data-role='province-detail']").each(function(){$(this).removeClass("li-cur"),$(this).attr("data-id")==i&&$(this).addClass("li-cur")}),$("[data-role='city-detail']").each(function(){$(this).removeClass("li-cur")}),console.log("距离顶部："+a.location_module_offset_top),$(".popup").scrollTop(a.location_module_offset_top)):"city-detail"==e&&($("[data-role='city-detail']").each(function(){$(this).removeClass("li-cur")}),$(o).addClass("li-cur"))}),t.on("click",function(){var i=$(this).attr("data-role");if("province-data"==i||"city-data"==i){console.log("距离顶部："+a.location_module_offset_top),$(".popup").scrollTop(a.location_module_offset_top),console.log("点击了common_data"),console.log("data_role:"+i),console.log(o);var c=o.length;console.log("common_list_len:"+c);for(var r=0;c>r;r++)$(e[r]).hasClass("dn")||($(e[r]).addClass("dn"),console.log($(e[r]))),$(t[r]).hasClass("sel-cur")&&$(t[r]).removeClass("sel-cur");$("[data-role='"+i+"-list-wrap']").removeClass("dn"),$("[data-role='"+i+"']").addClass("sel-cur")}}),i.on("click",function(){$("[common-data-role='condition-li']").each(function(){$(this).removeClass("li-cur")}),a._render_tab_list("province","0","0");for(var e=o.length,i=0;e>i;i++)$(t[i]).hasClass("sel-cur")&&$(t[i]).removeClass("sel-cur");$("[data-role='province-data']").addClass("sel-cur"),$("[data-role='province-detail']").each(function(){$(this).removeClass("li-cur")}),$("[data-role='city-detail']").each(function(){$(this).removeClass("li-cur")}),a.province_id="0"})}},o.exports=e});