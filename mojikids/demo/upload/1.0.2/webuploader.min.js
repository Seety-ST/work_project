/*! WebUploader 0.1.6 */
(function(e,b){var a={},c=function(o,n){var l,k,m;if(typeof o==="string"){return f(o)}else{l=[];for(k=o.length,m=0;m<k;m++){l.push(f(o[m]))}return n.apply(null,l)}},i=function(m,l,k){if(arguments.length===2){k=l;l=null}c(l||[],function(){j(m,k,arguments)})},j=function(o,n,m){var l={exports:n},k;if(typeof n==="function"){m.length||(m=[c,l.exports,l]);k=n.apply(null,m);k!==undefined&&(l.exports=k)}a[o]=l.exports},f=function(l){var k=a[l]||e[l];if(!k){throw new Error("`"+l+"` is undefined")}return k},g=function(q){var m,o,p,l,n,k;k=function(r){return r&&(r.charAt(0).toUpperCase()+r.substr(1))};for(m in a){o=q;if(!a.hasOwnProperty(m)){continue}p=m.split("/");n=k(p.pop());while((l=k(p.shift()))){o[l]=o[l]||{};o=o[l]}o[n]=a[m]}return q},d=function(k){e.__dollar=k;return g(b(e,i,c))},h;if(typeof module==="object"&&typeof module.exports==="object"){module.exports=d()}else{if(typeof define==="function"&&define.amd){define(["jquery"],d)}else{h=e.WebUploader;e.WebUploader=d();e.WebUploader.noConflict=function(){e.WebUploader=h}}}})(window,function(a,c,b){c("dollar-third",[],function(){var d=a.__dollar||a.jQuery||a.Zepto;if(!d){throw new Error("jQuery or Zepto not found!")}return d});c("dollar",["dollar-third"],function(d){return d});c("promise-third",["dollar"],function(d){return{Deferred:d.Deferred,when:d.when,isPromise:function(e){return e&&typeof e.then==="function"}}});c("promise",["promise-third"],function(d){return d});c("base",["dollar","promise"],function(h,j){var g=function(){},f=Function.call;function e(k){return function(){return f.apply(k,arguments)}}function i(l,k){return function(){return l.apply(k,arguments)}}function d(k){var l;if(Object.create){return Object.create(k)}else{l=function(){};l.prototype=k;return new l()}}return{version:"0.1.6",$:h,Deferred:j.Deferred,isPromise:j.isPromise,when:j.when,browser:(function(p){var n={},o=p.match(/WebKit\/([\d.]+)/),q=p.match(/Chrome\/([\d.]+)/)||p.match(/CriOS\/([\d.]+)/),r=p.match(/MSIE\s([\d\.]+)/)||p.match(/(?:trident)(?:.*rv:([\w.]+))?/i),m=p.match(/Firefox\/([\d.]+)/),k=p.match(/Safari\/([\d.]+)/),l=p.match(/OPR\/([\d.]+)/);o&&(n.webkit=parseFloat(o[1]));q&&(n.chrome=parseFloat(q[1]));r&&(n.ie=parseFloat(r[1]));m&&(n.firefox=parseFloat(m[1]));k&&(n.safari=parseFloat(k[1]));l&&(n.opera=parseFloat(l[1]));return n})(navigator.userAgent),os:(function(l){var k={},n=l.match(/(?:Android);?[\s\/]+([\d.]+)?/),m=l.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);n&&(k.android=parseFloat(n[1]));m&&(k.ios=parseFloat(m[1].replace(/_/g,".")));return k})(navigator.userAgent),inherits:function(m,l,k){var n;if(typeof l==="function"){n=l;l=null}else{if(l&&l.hasOwnProperty("constructor")){n=l.constructor}else{n=function(){return m.apply(this,arguments)}}}h.extend(true,n,m,k||{});n.__super__=m.prototype;n.prototype=d(m.prototype);l&&h.extend(true,n.prototype,l);return n},noop:g,bindFn:i,log:(function(){if(a.console){return i(console.log,console)}return g})(),nextTick:(function(){return function(k){setTimeout(k,1)}})(),slice:e([].slice),guid:(function(){var k=0;return function(l){var m=(+new Date()).toString(32),n=0;for(;n<5;n++){m+=Math.floor(Math.random()*65535).toString(32)}return(l||"wu_")+m+(k++).toString(32)}})(),formatSize:function(m,k,l){var n;l=l||["B","K","M","G","TB"];while((n=l.shift())&&m>1024){m=m/1024}return(n==="B"?m:m.toFixed(k||2))+n}}});c("mediator",["base"],function(f){var g=f.$,k=[].slice,j=/\s+/,e;function d(l,m,o,n){return g.grep(l,function(p){return p&&(!m||p.e===m)&&(!o||p.cb===o||p.cb._cb===o)&&(!n||p.ctx===n)})}function i(l,n,m){g.each((l||"").split(j),function(o,p){m(p,n)})}function h(n,m){var q=false,o=-1,l=n.length,p;while(++o<l){p=n[o];if(p.cb.apply(p.ctx2,m)===false){q=true;break}}return !q}e={on:function(l,o,m){var n=this,p;if(!o){return this}p=this._events||(this._events=[]);i(l,o,function(q,s){var r={e:q};r.cb=s;r.ctx=m;r.ctx2=m||n;r.id=p.length;p.push(r)});return this},once:function(l,o,m){var n=this;if(!o){return n}i(l,o,function(p,r){var q=function(){n.off(p,q);return r.apply(m||n,arguments)};q._cb=r;n.on(p,q,m)});return n},off:function(o,l,m){var n=this._events;if(!n){return this}if(!o&&!l&&!m){this._events=[];return this}i(o,l,function(q,p){g.each(d(n,q,p,m),function(){delete n[this.id]})});return this},trigger:function(o){var m,l,n;if(!this._events||!o){return this}m=k.call(arguments,1);l=d(this._events,o);n=d(this._events,"all");return h(l,m)&&h(n,arguments)}};return g.extend({installTo:function(l){return g.extend(l,e)}},e)});c("uploader",["base","mediator"],function(d,g){var e=d.$;function f(h){this.options=e.extend(true,{},f.options,h);this._init(this.options)}f.options={};g.installTo(f.prototype);e.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",cancelFile:"cancel-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",predictRuntimeType:"predict-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(h,i){f.prototype[h]=function(){return this.request(i,arguments)}});e.extend(f.prototype,{state:"pending",_init:function(i){var h=this;h.request("init",i,function(){h.state="ready";h.trigger("ready")})},option:function(h,j){var i=this.options;if(arguments.length>1){if(e.isPlainObject(j)&&e.isPlainObject(i[h])){e.extend(i[h],j)}else{i[h]=j}}else{return h?i[h]:i}},getStats:function(){var h=this.request("get-stats");return h?{successNum:h.numOfSuccess,progressNum:h.numOfProgress,cancelNum:h.numOfCancel,invalidNum:h.numOfInvalid,uploadFailNum:h.numOfUploadFailed,queueNum:h.numOfQueue,interruptNum:h.numofInterrupt}:{}},trigger:function(j){var i=[].slice.call(arguments,1),k=this.options,h="on"+j.substring(0,1).toUpperCase()+j.substring(1);if(g.trigger.apply(this,arguments)===false||e.isFunction(k[h])&&k[h].apply(this,i)===false||e.isFunction(this[h])&&this[h].apply(this,i)===false||g.trigger.apply(g,[this,j].concat(i))===false){return false}return true},destroy:function(){this.request("destroy",arguments);this.off()},request:d.noop});d.create=f.create=function(h){return new f(h)};d.Uploader=f;return f});c("runtime/runtime",["base","mediator"],function(f,i){var g=f.$,d={},h=function(k){for(var j in k){if(k.hasOwnProperty(j)){return j}}return null};function e(j){this.options=g.extend({container:document.body},j);this.uid=f.guid("rt_")}g.extend(e.prototype,{getContainer:function(){var l=this.options,j,k;if(this._container){return this._container}j=g(l.container||document.body);k=g(document.createElement("div"));k.attr("id","rt_"+this.uid);k.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});j.append(k);j.addClass("webuploader-container");this._container=k;this._parent=j;return k},init:f.noop,exec:f.noop,destroy:function(){this._container&&this._container.remove();this._parent&&this._parent.removeClass("webuploader-container");this.off()}});e.orders="html5,flash";e.addRuntime=function(k,j){d[k]=j};e.hasRuntime=function(j){return !!(j?d[j]:h(d))};e.create=function(m,j){var k,l;j=j||e.orders;g.each(j.split(/\s*,\s*/g),function(){if(d[this]){k=this;return false}});k=k||h(d);if(!k){throw new Error("Runtime Error")}l=new d[k](m);return l};i.installTo(e.prototype);return e});c("runtime/client",["base","mediator","runtime/runtime"],function(g,h,f){var d;d=(function(){var i={};return{add:function(j){i[j.uid]=j},get:function(j,l){var k;if(j){return i[j]}for(k in i){if(l&&i[k].__standalone){continue}return i[k]}return null},remove:function(j){delete i[j.uid]}}})();function e(j,k){var i=g.Deferred(),l;this.uid=g.guid("client_");this.runtimeReady=function(m){return i.done(m)};this.connectRuntime=function(n,m){if(l){throw new Error("already connected!")}i.done(m);if(typeof n==="string"&&d.get(n)){l=d.get(n)}l=l||d.get(null,k);if(!l){l=f.create(n,n.runtimeOrder);l.__promise=i.promise();l.once("ready",i.resolve);l.init();d.add(l);l.__client=1}else{g.$.extend(l.options,n);l.__promise.then(i.resolve);l.__client++}k&&(l.__standalone=k);return l};this.getRuntime=function(){return l};this.disconnectRuntime=function(){if(!l){return}l.__client--;if(l.__client<=0){d.remove(l);delete l.__promise;l.destroy()}l=null};this.exec=function(){if(!l){return}var m=g.slice(arguments);j&&m.unshift(j);return l.exec.apply(this,m)};this.getRuid=function(){return l&&l.uid};this.destroy=(function(m){return function(){m&&m.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}})(this.destroy)}h.installTo(e.prototype);return e});c("lib/dnd",["base","mediator","runtime/client"],function(e,h,d){var f=e.$;function g(i){i=this.options=f.extend({},g.options,i);i.container=f(i.container);if(!i.container.length){return}d.call(this,"DragAndDrop")}g.options={accept:null,disableGlobalDnd:false};e.inherits(d,{constructor:g,init:function(){var i=this;i.connectRuntime(i.options,function(){i.exec("init");i.trigger("ready")})}});h.installTo(g.prototype);return g});c("widgets/widget",["base","uploader"],function(g,e){var f=g.$,i=e.prototype._init,l=e.prototype.destroy,d={},h=[];function j(o){if(!o){return false}var m=o.length,n=f.type(o);if(o.nodeType===1&&m){return true}return n==="array"||n!=="function"&&n!=="string"&&(m===0||typeof m==="number"&&m>0&&(m-1) in o)}function k(m){this.owner=m;this.options=m.options}f.extend(k.prototype,{init:g.noop,invoke:function(n,m){var o=this.responseMap;if(!o||!(n in o)||!(o[n] in this)||!f.isFunction(this[o[n]])){return d}return this[o[n]].apply(this,m)},request:function(){return this.owner.request.apply(this.owner,arguments)}});f.extend(e.prototype,{_init:function(){var n=this,m=n._widgets=[],o=n.options.disableWidgets||"";f.each(h,function(q,p){(!o||!~o.indexOf(p._name))&&m.push(new p(n))});return i.apply(n,arguments)},request:function(r,t,w){var q=0,v=this._widgets,s=v&&v.length,p=[],o=[],n,m,u,x;t=j(t)?t:[t];for(;q<s;q++){n=v[q];m=n.invoke(r,t);if(m!==d){if(g.isPromise(m)){o.push(m)}else{p.push(m)}}}if(w||o.length){u=g.when.apply(g,o);x=u.pipe?"pipe":"then";return u[x](function(){var y=g.Deferred(),z=arguments;if(z.length===1){z=z[0]}setTimeout(function(){y.resolve(z)},1);return y.promise()})[w?x:"done"](w||g.noop)}else{return p[0]}},destroy:function(){l.apply(this,arguments);this._widgets=null}});e.register=k.register=function(n,p){var o={init:"init",destroy:"destroy",name:"anonymous"},m;if(arguments.length===1){p=n;f.each(p,function(q){if(q[0]==="_"||q==="name"){q==="name"&&(o.name=p.name);return}o[q.replace(/[A-Z]/g,"-$&").toLowerCase()]=q})}else{o=f.extend(o,n)}p.responseMap=o;m=g.inherits(k,p);m._name=o.name;h.push(m);return m};e.unRegister=k.unRegister=function(m){if(!m||m==="anonymous"){return}for(var n=h.length;n--;){if(h[n]._name===m){h.splice(n,1)}}};return k});c("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(e,g,d){var f=e.$;g.options.dnd="";return g.register({name:"dnd",init:function(l){if(!l.dnd||this.request("predict-runtime-type")!=="html5"){return}var k=this,h=e.Deferred(),i=f.extend({},{disableGlobalDnd:l.disableGlobalDnd,container:l.dnd,accept:l.accept}),j;this.dnd=j=new d(i);j.once("ready",h.resolve);j.on("drop",function(m){k.request("add-file",[m])});j.on("accept",function(m){return k.owner.trigger("dndAccept",m)});j.init();return h.promise()},destroy:function(){this.dnd&&this.dnd.destroy()}})});c("lib/filepaste",["base","mediator","runtime/client"],function(f,h,e){var g=f.$;function d(i){i=this.options=g.extend({},i);i.container=g(i.container||document.body);e.call(this,"FilePaste")}f.inherits(e,{constructor:d,init:function(){var i=this;i.connectRuntime(i.options,function(){i.exec("init");i.trigger("ready")})}});h.installTo(d.prototype);return d});c("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(e,g,d){var f=e.$;return g.register({name:"paste",init:function(k){if(!k.paste||this.request("predict-runtime-type")!=="html5"){return}var j=this,h=e.Deferred(),i=f.extend({},{container:k.paste,accept:k.accept}),l;this.paste=l=new d(i);l.once("ready",h.resolve);l.on("paste",function(m){j.owner.request("add-file",[m])});l.init();return h.promise()},destroy:function(){this.paste&&this.paste.destroy()}})});c("lib/blob",["base","runtime/client"],function(e,d){function f(h,g){var i=this;i.source=g;i.ruid=h;this.size=g.size||0;if(!g.type&&this.ext&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)){this.type="image/"+(this.ext==="jpg"?"jpeg":this.ext)}else{this.type=g.type||"application/octet-stream"}d.call(i,"Blob");this.uid=g.uid||this.uid;if(h){i.connectRuntime(h)}}e.inherits(d,{constructor:f,slice:function(h,g){return this.exec("slice",h,g)},getSource:function(){return this.source}});return f});c("lib/file",["base","lib/blob"],function(g,h){var f=1,d=/\.([^.]+)$/;function e(i,j){var k;this.name=j.name||("untitled"+f++);k=d.exec(j.name)?RegExp.$1.toLowerCase():"";if(!k&&j.type){k=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(j.type)?RegExp.$1.toLowerCase():"";this.name+="."+k}this.ext=k;this.lastModifiedDate=j.lastModifiedDate||(new Date()).toLocaleString();h.apply(this,arguments)}return g.inherits(h,e)});c("lib/filepicker",["base","runtime/client","lib/file"],function(f,e,d){var h=f.$;function g(i){i=this.options=h.extend({},g.options,i);i.container=h(i.id);if(!i.container.length){throw new Error("°´Å¥Ö¸¶¨´íÎó")}i.innerHTML=i.innerHTML||i.label||i.container.html()||"";i.button=h(i.button||document.createElement("div"));i.button.html(i.innerHTML);i.container.html(i.button);e.call(this,"FilePicker",true)}g.options={button:null,container:null,label:null,innerHTML:null,multiple:true,accept:null,name:"file"};f.inherits(e,{constructor:g,init:function(){var k=this,j=k.options,i=j.button;i.addClass("webuploader-pick");k.on("all",function(l){var m;switch(l){case"mouseenter":i.addClass("webuploader-pick-hover");break;case"mouseleave":i.removeClass("webuploader-pick-hover");break;case"change":m=k.exec("getFiles");k.trigger("select",h.map(m,function(n){n=new d(k.getRuid(),n);n._refer=j.container;return n}),j.container);break}});k.connectRuntime(j,function(){k.refresh();k.exec("init",j);k.trigger("ready")});this._resizeHandler=f.bindFn(this.refresh,this);h(a).on("resize",this._resizeHandler)},refresh:function(){var j=this.getRuntime().getContainer(),i=this.options.button,k=i.outerWidth?i.outerWidth():i.width(),l=i.outerHeight?i.outerHeight():i.height(),m=i.offset();k&&l&&j.css({bottom:"auto",right:"auto",width:k+"px",height:l+"px"}).offset(m)},enable:function(){var i=this.options.button;i.removeClass("webuploader-pick-disable");this.refresh()},disable:function(){var i=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"});i.addClass("webuploader-pick-disable")},destroy:function(){var i=this.options.button;h(a).off("resize",this._resizeHandler);i.removeClass("webuploader-pick-disable webuploader-pick-hover webuploader-pick")}});return g});c("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(d,g,f){var e=d.$;e.extend(g.options,{pick:null,accept:null});return g.register({name:"picker",init:function(h){this.pickers=[];return h.pick&&this.addBtn(h.pick)},refresh:function(){e.each(this.pickers,function(){this.refresh()})},addBtn:function(j){var l=this,k=l.options,i=k.accept,h=[];if(!j){return}e.isPlainObject(j)||(j={id:j});e(j.id).each(function(){var o,n,m;m=d.Deferred();o=e.extend({},j,{accept:e.isPlainObject(i)?[i]:i,swf:k.swf,runtimeOrder:k.runtimeOrder,id:this});n=new f(o);n.once("ready",m.resolve);n.on("select",function(p){l.owner.request("add-file",[p])});n.on("dialogopen",function(){l.owner.trigger("dialogOpen",n.button)});n.init();l.pickers.push(n);h.push(m.promise())});return d.when.apply(d,h)},disable:function(){e.each(this.pickers,function(){this.disable()})},enable:function(){e.each(this.pickers,function(){this.enable()})},destroy:function(){e.each(this.pickers,function(){this.destroy()});this.pickers=null}})});c("lib/image",["base","runtime/client","lib/blob"],function(f,e,h){var g=f.$;function d(i){this.options=g.extend({},d.options,i);e.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}d.options={quality:90,crop:false,preserveHeaders:false,allowMagnify:false};f.inherits(e,{constructor:d,info:function(i){if(i){this._info=i;return this}return this._info},meta:function(i){if(i){this._meta=i;return this}return this._meta},loadFromBlob:function(i){var k=this,j=i.getRuid();this.connectRuntime(j,function(){k.exec("init",k.options);k.exec("loadFromBlob",i)})},resize:function(){var i=f.slice(arguments);return this.exec.apply(this,["resize"].concat(i))},crop:function(){var i=f.slice(arguments);return this.exec.apply(this,["crop"].concat(i))},getAsDataUrl:function(i){return this.exec("getAsDataUrl",i)},getAsBlob:function(j){var i=this.exec("getAsBlob",j);return new h(this.getRuid(),i)}});return d});c("widgets/image",["base","uploader","lib/image","widgets/widget"],function(e,h,d){var g=e.$,f;f=(function(i){var j=0,l=[],k=function(){var m;while(l.length&&j<i){m=l.shift();j+=m[0];m[1]()}};return function(n,o,m){l.push([o,m]);n.once("destroy",function(){j-=o;setTimeout(k,1)});setTimeout(k,1)}})(5*1024*1024);g.extend(h.options,{thumb:{width:110,height:110,quality:70,allowMagnify:true,crop:true,preserveHeaders:false,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:false,crop:false,preserveHeaders:true}});return h.register({name:"image",makeThumb:function(j,i,k,m){var l,n;j=this.request("get-file",j);if(!j.type.match(/^image/)){i(true);return}l=g.extend({},this.options.thumb);if(g.isPlainObject(k)){l=g.extend(l,k);k=null}k=k||l.width;m=m||l.height;n=new d(l);n.once("load",function(){j._info=j._info||n.info();j._meta=j._meta||n.meta();if(k<=1&&k>0){k=j._info.width*k}if(m<=1&&m>0){m=j._info.height*m}n.resize(k,m)});n.once("complete",function(){i(false,n.getAsDataUrl(l.type));n.destroy()});n.once("error",function(o){i(o||true);n.destroy()});f(n,j.source.size,function(){j._info&&n.info(j._info);j._meta&&n.meta(j._meta);n.loadFromBlob(j.source)})},beforeSendFile:function(l){var m=this.options.compress||this.options.resize,k=m&&m.compressSize||0,i=m&&m.noCompressIfLarger||false,n,j;l=this.request("get-file",l);if(!m||!~"image/jpeg,image/jpg".indexOf(l.type)||l.size<k||l._compressed){return}m=g.extend({},m);j=e.Deferred();n=new d(m);j.always(function(){n.destroy();n=null});n.once("error",j.reject);n.once("load",function(){var o=m.width,p=m.height;l._info=l._info||n.info();l._meta=l._meta||n.meta();if(o<=1&&o>0){o=l._info.width*o}if(p<=1&&p>0){p=l._info.height*p}n.resize(o,p)});n.once("complete",function(){var o,p;try{o=n.getAsBlob(m.type);p=l.size;if(!i||o.size<p){l.source=o;l.size=o.size;l.trigger("resize",o.size,p)}l._compressed=true;j.resolve()}catch(q){j.resolve()}});l._info&&n.info(l._info);l._meta&&n.meta(l._meta);n.loadFromBlob(l.source);return j.promise()}})});c("file",["base","mediator"],function(g,l){var e=g.$,j="WU_FILE_",d=0,f=/\.([^.]+)$/,h={};function i(){return j+d++}function k(m){this.name=m.name||"Untitled";this.size=m.size||0;this.type=m.type||"application/octet-stream";this.lastModifiedDate=m.lastModifiedDate||(new Date()*1);this.id=i();this.ext=f.exec(this.name)?RegExp.$1:"";this.statusText="";h[this.id]=k.Status.INITED;this.source=m;this.loaded=0;this.on("error",function(n){this.setStatus(k.Status.ERROR,n)})}e.extend(k.prototype,{setStatus:function(m,o){var n=h[this.id];typeof o!=="undefined"&&(this.statusText=o);if(m!==n){h[this.id]=m;this.trigger("statuschange",m,n)}},getStatus:function(){return h[this.id]},getSource:function(){return this.source},destroy:function(){this.off();delete h[this.id]}});l.installTo(k.prototype);k.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"};return k});c("queue",["base","mediator","file"],function(d,i,h){var g=d.$,f=h.Status;function e(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0,numofDeleted:0,numofInterrupt:0};this._queue=[];this._map={}}g.extend(e.prototype,{append:function(j){this._queue.push(j);this._fileAdded(j);return this},prepend:function(j){this._queue.unshift(j);this._fileAdded(j);return this},getFile:function(j){if(typeof j!=="string"){return j}return this._map[j]},fetch:function(m){var j=this._queue.length,l,k;m=m||f.QUEUED;for(l=0;l<j;l++){k=this._queue[l];if(m===k.getStatus()){return k}}return null},sort:function(j){if(typeof j==="function"){this._queue.sort(j)}},getFiles:function(){var n=[].slice.call(arguments,0),k=[],m=0,j=this._queue.length,l;for(;m<j;m++){l=this._queue[m];if(n.length&&!~g.inArray(l.getStatus(),n)){continue}k.push(l)}return k},removeFile:function(k){var l=this,j=this._map[k.id];if(j){delete this._map[k.id];k.destroy();this.stats.numofDeleted++}},_fileAdded:function(k){var l=this,j=this._map[k.id];if(!j){this._map[k.id]=k;k.on("statuschange",function(n,m){l._onFileStatusChange(n,m)})}},_onFileStatusChange:function(l,k){var j=this.stats;switch(k){case f.PROGRESS:j.numOfProgress--;break;case f.QUEUED:j.numOfQueue--;break;case f.ERROR:j.numOfUploadFailed--;break;case f.INVALID:j.numOfInvalid--;break;case f.INTERRUPT:j.numofInterrupt--;break}switch(l){case f.QUEUED:j.numOfQueue++;break;case f.PROGRESS:j.numOfProgress++;break;case f.ERROR:j.numOfUploadFailed++;break;case f.COMPLETE:j.numOfSuccess++;break;case f.CANCELLED:j.numOfCancel++;break;case f.INVALID:j.numOfInvalid++;break;case f.INTERRUPT:j.numofInterrupt++;break}}});i.installTo(e.prototype);return e});c("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(j,f,g,l,k,e){var h=j.$,i=/\.\w+$/,d=l.Status;return f.register({name:"queue",init:function(m){var s=this,t,r,p,u,q,o,n;if(h.isPlainObject(m.accept)){m.accept=[m.accept]}if(m.accept){q=[];for(p=0,r=m.accept.length;p<r;p++){u=m.accept[p].extensions;u&&q.push(u)}if(q.length){o="\\."+q.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"}s.accept=new RegExp(o,"i")}s.queue=new g();s.stats=s.queue.stats;if(this.request("predict-runtime-type")!=="html5"){return}t=j.Deferred();this.placeholder=n=new e("Placeholder");n.connectRuntime({runtimeOrder:"html5"},function(){s._ruid=n.getRuid();t.resolve()});return t.promise()},_wrapFile:function(m){if(!(m instanceof l)){if(!(m instanceof k)){if(!this._ruid){throw new Error("Can't add external files.")}m=new k(this._ruid,m)}m=new l(m)}return m},acceptFile:function(m){var n=!m||!m.size||this.accept&&i.exec(m.name)&&!this.accept.test(m.name);return !n},_addFile:function(m){var n=this;m=n._wrapFile(m);if(!n.owner.trigger("beforeFileQueued",m)){return}if(!n.acceptFile(m)){n.owner.trigger("error","Q_TYPE_DENIED",m);return}n.queue.append(m);n.owner.trigger("fileQueued",m);return m},getFile:function(m){return this.queue.getFile(m)},addFile:function(n){var m=this;if(!n.length){n=[n]}n=h.map(n,function(o){return m._addFile(o)});m.owner.trigger("filesQueued",n);if(m.options.auto){setTimeout(function(){m.request("start-upload")},20)}},getStats:function(){return this.stats},removeFile:function(m,o){var n=this;m=m.id?m:n.queue.getFile(m);this.request("cancel-file",m);if(o){this.queue.removeFile(m)}},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(p,n){var r=this,q,o,m;if(p){p=p.id?p:r.queue.getFile(p);p.setStatus(d.QUEUED);n||r.request("start-upload");return}q=r.queue.getFiles(d.ERROR);o=0;m=q.length;for(;o<m;o++){p=q[o];p.setStatus(d.QUEUED)}r.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.owner.trigger("reset");this.queue=new g();this.stats=this.queue.stats},destroy:function(){this.reset();this.placeholder&&this.placeholder.destroy()}})});c("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(e,d){e.support=function(){return d.hasRuntime.apply(d,arguments)};return e.register({name:"runtime",init:function(){if(!this.predictRuntimeType()){throw Error("Runtime Error")}},predictRuntimeType:function(){var g=this.options.runtimeOrder||d.orders,j=this.type,h,f;if(!j){g=g.split(/\s*,\s*/g);for(h=0,f=g.length;h<f;h++){if(d.hasRuntime(g[h])){this.type=j=g[h];break}}}return j}})});c("lib/transport",["base","runtime/client","mediator"],function(e,d,h){var f=e.$;function g(j){var i=this;j=i.options=f.extend(true,{},g.options,j||{});d.call(this,"Transport");this._blob=null;this._formData=j.formData||{};this._headers=j.headers||{};this.on("progress",this._timeout);this.on("load error",function(){i.trigger("progress",1);clearTimeout(i._timer)})}g.options={server:"",method:"POST",withCredentials:false,fileVal:"file",timeout:2*60*1000,formData:{},headers:{},sendAsBinary:false};f.extend(g.prototype,{appendBlob:function(j,i,k){var m=this,l=m.options;if(m.getRuid()){m.disconnectRuntime()}m.connectRuntime(i.ruid,function(){m.exec("init")});m._blob=i;l.fileVal=j||l.fileVal;l.filename=k||l.filename},append:function(i,j){if(typeof i==="object"){f.extend(this._formData,i)}else{this._formData[i]=j}},setRequestHeader:function(i,j){if(typeof i==="object"){f.extend(this._headers,i)}else{this._headers[i]=j}},send:function(i){this.exec("send",i);this._timeout()},abort:function(){clearTimeout(this._timer);return this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var i=this,j=i.options.timeout;if(!j){return}clearTimeout(i._timer);i._timer=setTimeout(function(){i.abort();i.trigger("error","timeout")},j)}});h.installTo(g.prototype);return g});c("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(d,j,k,i){var h=d.$,e=d.isPromise,g=k.Status;h.extend(j.options,{prepareNextFile:false,chunked:false,chunkSize:5*1024*1024,chunkRetry:2,threads:3,formData:{}});function f(o,p){var t=[],l=o.source,u=l.size,n=p?Math.ceil(u/p):1,m=0,s=0,r,q;q={file:o,has:function(){return !!t.length},shift:function(){return t.shift()},unshift:function(v){t.unshift(v)}};while(s<n){r=Math.min(p,u-m);t.push({file:o,start:m,end:p?(m+r):u,total:u,chunks:n,chunk:s++,cuted:q});m+=r}o.blocks=t.concat();o.remaning=t.length;return q}j.register({name:"upload",init:function(){var l=this.owner,m=this;this.runing=false;this.progress=false;l.on("startUpload",function(){m.progress=true}).on("uploadFinished",function(){m.progress=false});this.pool=[];this.stack=[];this.pending=[];this.remaning=0;this.__tick=d.bindFn(this._tick,this);l.on("uploadComplete",function(n){n.blocks&&h.each(n.blocks,function(p,o){o.transport&&(o.transport.abort(),o.transport.destroy());delete o.transport});delete n.blocks;delete n.remaning})},reset:function(){this.request("stop-upload",true);this.runing=false;this.pool=[];this.stack=[];this.pending=[];this.remaning=0;this._trigged=false;this._promise=null},startUpload:function(l){var n=this;h.each(n.request("get-files",g.INVALID),function(){n.request("remove-file",this)});if(l){l=l.id?l:n.request("get-file",l);if(l.getStatus()===g.INTERRUPT){h.each(n.pool,function(p,o){if(o.file!==l){return}o.transport&&o.transport.send()});l.setStatus(g.QUEUED)}else{if(l.getStatus()===g.PROGRESS){return}else{l.setStatus(g.QUEUED)}}}else{h.each(n.request("get-files",[g.INITED]),function(){this.setStatus(g.QUEUED)})}if(n.runing){return}n.runing=true;var m=[];h.each(n.pool,function(p,o){var q=o.file;if(q.getStatus()===g.INTERRUPT){m.push(q);n._trigged=false;o.transport&&o.transport.send()}});var l;while((l=m.shift())){l.setStatus(g.PROGRESS)}l||h.each(n.request("get-files",g.INTERRUPT),function(){this.setStatus(g.PROGRESS)});n._trigged=false;d.nextTick(n.__tick);n.owner.trigger("startUpload")},stopUpload:function(l,n){var m=this;if(l===true){n=l;l=null}if(m.runing===false){return}if(l){l=l.id?l:m.request("get-file",l);if(l.getStatus()!==g.PROGRESS&&l.getStatus()!==g.QUEUED){return}l.setStatus(g.INTERRUPT);h.each(m.pool,function(p,o){if(o.file!==l){return}o.transport&&o.transport.abort();m._putback(o);m._popBlock(o)});return d.nextTick(m.__tick)}m.runing=false;if(this._promise&&this._promise.file){this._promise.file.setStatus(g.INTERRUPT)}n&&h.each(m.pool,function(p,o){o.transport&&o.transport.abort();o.file.setStatus(g.INTERRUPT)});m.owner.trigger("stopUpload")},cancelFile:function(l){l=l.id?l:this.request("get-file",l);l.blocks&&h.each(l.blocks,function(o,n){var m=n.transport;if(m){m.abort();m.destroy();delete n.transport}});l.setStatus(g.CANCELLED);this.owner.trigger("fileDequeued",l)},isInProgress:function(){return !!this.progress},_getStats:function(){return this.request("get-stats")},skipFile:function(l,m){l=l.id?l:this.request("get-file",l);l.setStatus(m||g.COMPLETE);l.skipped=true;l.blocks&&h.each(l.blocks,function(p,o){var n=o.transport;if(n){n.abort();n.destroy();delete o.transport}});this.owner.trigger("uploadSkip",l)},_tick:function(){var n=this,m=n.options,l,o;if(n._promise){return n._promise.always(n.__tick)}if(n.pool.length<m.threads&&(o=n._nextBlock())){n._trigged=false;l=function(p){n._promise=null;p&&p.file&&n._startSend(p);d.nextTick(n.__tick)};n._promise=e(o)?o.always(l):l(o)}else{if(!n.remaning&&!n._getStats().numOfQueue&&!n._getStats().numofInterrupt){n.runing=false;n._trigged||d.nextTick(function(){n.owner.trigger("uploadFinished")});n._trigged=true}}},_putback:function(m){var l;m.cuted.unshift(m);l=this.stack.indexOf(m.cuted);if(!~l){this.stack.unshift(m.cuted)}},_getStack:function(){var m=0,l;while((l=this.stack[m++])){if(l.has()&&l.file.getStatus()===g.PROGRESS){return l}else{if(!l.has()||l.file.getStatus()!==g.PROGRESS&&l.file.getStatus()!==g.INTERRUPT){this.stack.splice(--m,1)}}}return null},_nextBlock:function(){var q=this,p=q.options,m,o,l,n;if((m=this._getStack())){if(p.prepareNextFile&&!q.pending.length){q._prepareNextFile()}return m.shift()}else{if(q.runing){if(!q.pending.length&&q._getStats().numOfQueue){q._prepareNextFile()}o=q.pending.shift();l=function(r){if(!r){return null}m=f(r,p.chunked?p.chunkSize:0);q.stack.push(m);return m.shift()};if(e(o)){n=o.file;o=o[o.pipe?"pipe":"then"](l);o.file=n;return o}return l(o)}}},_prepareNextFile:function(){var m=this,l=m.request("fetch-file"),o=m.pending,n;if(l){n=m.request("before-send-file",l,function(){if(l.getStatus()===g.PROGRESS||l.getStatus()===g.INTERRUPT){return l}return m._finishFile(l)});m.owner.trigger("uploadStart",l);l.setStatus(g.PROGRESS);n.file=l;n.done(function(){var p=h.inArray(n,o);~p&&o.splice(p,1,l)});n.fail(function(p){l.setStatus(g.ERROR,p);m.owner.trigger("uploadError",l,p);m.owner.trigger("uploadComplete",l)});o.push(n)}},_popBlock:function(m){var l=h.inArray(m,this.pool);this.pool.splice(l,1);m.file.remaning--;this.remaning--},_startSend:function(o){var m=this,l=o.file,n;if(l.getStatus()!==g.PROGRESS){if(l.getStatus()===g.INTERRUPT){m._putback(o)}return}m.pool.push(o);m.remaning++;o.blob=o.chunks===1?l.source:l.source.slice(o.start,o.end);n=m.request("before-send",o,function(){if(l.getStatus()===g.PROGRESS){m._doSend(o)}else{m._popBlock(o);d.nextTick(m.__tick)}});n.fail(function(){if(l.remaning===1){m._finishFile(l).always(function(){o.percentage=1;m._popBlock(o);m.owner.trigger("uploadComplete",l);d.nextTick(m.__tick)})}else{o.percentage=1;m.updateFileProgress(l);m._popBlock(o);d.nextTick(m.__tick)}})},_doSend:function(p){var s=this,m=s.owner,l=s.options,o=p.file,t=new i(l),q=h.extend({},l.formData),n=h.extend({},l.headers),u,r;p.transport=t;t.on("destroy",function(){delete p.transport;s._popBlock(p);d.nextTick(s.__tick)});t.on("progress",function(v){p.percentage=v;s.updateFileProgress(o)});u=function(v){var w;r=t.getResponseAsJson()||{};r._raw=t.getResponse();w=function(x){v=x};if(!m.trigger("uploadAccept",p,r,w)){v=v||"server"}return v};t.on("error",function(w,v){p.retried=p.retried||0;if(p.chunks>1&&~"http,abort".indexOf(w)&&p.retried<l.chunkRetry){p.retried++;t.send()}else{if(!v&&w==="server"){w=u(w)}o.setStatus(g.ERROR,w);m.trigger("uploadError",o,w);m.trigger("uploadComplete",o)}});t.on("load",function(){var v;if((v=u())){t.trigger("error",v,true);return}if(o.remaning===1){s._finishFile(o,r)}else{t.destroy()}});q=h.extend(q,{id:o.id,name:o.name,type:o.type,lastModifiedDate:o.lastModifiedDate,size:o.size});p.chunks>1&&h.extend(q,{chunks:p.chunks,chunk:p.chunk});m.trigger("uploadBeforeSend",p,q,n);t.appendBlob(l.fileVal,p.blob,o.name);t.append(q);t.setRequestHeader(n);t.send()},_finishFile:function(n,m,o){var l=this.owner;return l.request("after-send-file",arguments,function(){n.setStatus(g.COMPLETE);l.trigger("uploadSuccess",n,m,o)}).fail(function(p){if(n.getStatus()===g.PROGRESS){n.setStatus(g.ERROR,p)}l.trigger("uploadError",n,p)}).always(function(){l.trigger("uploadComplete",n)})},updateFileProgress:function(m){var n=0,l=0;if(!m.blocks){return}h.each(m.blocks,function(p,o){l+=(o.percentage||0)*(o.end-o.start)});n=l/m.size;this.owner.trigger("uploadProgress",m,n||0)}})});c("widgets/validator",["base","uploader","file","widgets/widget"],function(d,h,i){var g=d.$,f={},e;e={addValidator:function(k,j){f[k]=j},removeValidator:function(j){delete f[j]}};h.register({name:"validator",init:function(){var j=this;d.nextTick(function(){g.each(f,function(){this.call(j.owner)})})}});e.addValidator("fileNumLimit",function(){var n=this,m=n.options,l=0,j=parseInt(m.fileNumLimit,10),k=true;if(!j){return}n.on("beforeFileQueued",function(o){if(l>=j&&k){k=false;this.trigger("error","Q_EXCEED_NUM_LIMIT",j,o);setTimeout(function(){k=true},1)}return l>=j?false:true});n.on("fileQueued",function(){l++});n.on("fileDequeued",function(){l--});n.on("reset",function(){l=0})});e.addValidator("fileSizeLimit",function(){var n=this,m=n.options,l=0,j=parseInt(m.fileSizeLimit,10),k=true;if(!j){return}n.on("beforeFileQueued",function(o){var p=l+o.size>j;if(p&&k){k=false;this.trigger("error","Q_EXCEED_SIZE_LIMIT",j,o);setTimeout(function(){k=true},1)}return p?false:true});n.on("fileQueued",function(o){l+=o.size});n.on("fileDequeued",function(o){l-=o.size});n.on("reset",function(){l=0})});e.addValidator("fileSingleSizeLimit",function(){var l=this,k=l.options,j=k.fileSingleSizeLimit;if(!j){return}l.on("beforeFileQueued",function(m){if(m.size>j){m.setStatus(i.Status.INVALID,"exceed_size");this.trigger("error","F_EXCEED_SIZE",j,m);return false}})});e.addValidator("duplicate",function(){var m=this,k=m.options,j={};if(k.duplicate){return}function l(r){var q=0,p=0,n=r.length,o;for(;p<n;p++){o=r.charCodeAt(p);q=o+(q<<6)+(q<<16)-q}return q}m.on("beforeFileQueued",function(n){var o=n.__hash||(n.__hash=l(n.name+n.size+n.lastModifiedDate));if(j[o]){this.trigger("error","F_DUPLICATE",n);return false}});m.on("fileQueued",function(n){var o=n.__hash;o&&(j[o]=true)});m.on("fileDequeued",function(n){var o=n.__hash;o&&(delete j[o])});m.on("reset",function(){j={}})});return e});c("lib/md5",["runtime/client","mediator"],function(e,f){function d(){e.call(this,"Md5")}f.installTo(d.prototype);d.prototype.loadFromBlob=function(g){var h=this;if(h.getRuid()){h.disconnectRuntime()}h.connectRuntime(g.ruid,function(){h.exec("init");h.exec("loadFromBlob",g)})};d.prototype.getResult=function(){return this.exec("getResult")};return d});c("widgets/md5",["base","uploader","lib/md5","lib/blob","widgets/widget"],function(e,f,d,g){return f.register({name:"md5",md5File:function(k,m,h){var l=new d(),j=e.Deferred(),i=(k instanceof g)?k:this.request("get-file",k).source;l.on("progress load",function(n){n=n||{};j.notify(n.total?n.loaded/n.total:1)});l.on("complete",function(){j.resolve(l.getResult())});l.on("error",function(n){j.reject(n)});if(arguments.length>1){m=m||0;h=h||0;m<0&&(m=i.size+m);h<0&&(h=i.size+h);h=Math.min(h,i.size);i=i.slice(m,h)}l.loadFromBlob(i);return j.promise()}})});c("runtime/compbase",[],function(){function d(e,f){this.owner=e;this.options=e.options;this.getRuntime=function(){return f};this.getRuid=function(){return f.uid};this.trigger=function(){return e.trigger.apply(e,arguments)}}return d});c("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(f,e,h){var g="html5",d={};function i(){var k={},l=this,j=this.destroy;e.apply(l,arguments);l.type=g;l.exec=function(n,q){var r=this,p=r.uid,o=f.slice(arguments,2),m;if(d[n]){m=k[p]=k[p]||new d[n](r,l);if(m[q]){return m[q].apply(m,o)}}};l.destroy=function(){return j&&j.apply(this,arguments)}}f.inherits(e,{constructor:i,init:function(){var j=this;setTimeout(function(){j.trigger("ready")},1)}});i.register=function(k,l){var j=d[k]=f.inherits(h,l);return j};if(a.Blob&&a.FileReader&&a.DataView){e.addRuntime(g,i)}return i});c("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(e,d){return e.register("Blob",{slice:function(i,f){var g=this.owner.source,h=g.slice||g.webkitSlice||g.mozSlice;g=h.call(g,i,f);return new d(this.getRuid(),g)}})});c("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(f,h,e){var g=f.$,d="webuploader-dnd-";return h.register("DragAndDrop",{init:function(){var i=this.elem=this.options.container;this.dragEnterHandler=f.bindFn(this._dragEnterHandler,this);this.dragOverHandler=f.bindFn(this._dragOverHandler,this);this.dragLeaveHandler=f.bindFn(this._dragLeaveHandler,this);this.dropHandler=f.bindFn(this._dropHandler,this);this.dndOver=false;i.on("dragenter",this.dragEnterHandler);i.on("dragover",this.dragOverHandler);i.on("dragleave",this.dragLeaveHandler);i.on("drop",this.dropHandler);if(this.options.disableGlobalDnd){g(document).on("dragover",this.dragOverHandler);g(document).on("drop",this.dropHandler)}},_dragEnterHandler:function(l){var k=this,j=k._denied||false,i;l=l.originalEvent||l;if(!k.dndOver){k.dndOver=true;i=l.dataTransfer.items;if(i&&i.length){k._denied=j=!k.trigger("accept",i)}k.elem.addClass(d+"over");k.elem[j?"addClass":"removeClass"](d+"denied")}l.dataTransfer.dropEffect=j?"none":"copy";return false},_dragOverHandler:function(j){var i=this.elem.parent().get(0);if(i&&!g.contains(i,j.currentTarget)){return false}clearTimeout(this._leaveTimer);this._dragEnterHandler.call(this,j);return false},_dragLeaveHandler:function(){var j=this,i;i=function(){j.dndOver=false;j.elem.removeClass(d+"over "+d+"denied")};clearTimeout(j._leaveTimer);j._leaveTimer=setTimeout(i,100);return false},_dropHandler:function(o){var l=this,j=l.getRuid(),n=l.elem.parent().get(0),i,m;if(n&&!g.contains(n,o.currentTarget)){return false}o=o.originalEvent||o;i=o.dataTransfer;try{m=i.getData("text/html")}catch(k){}l.dndOver=false;l.elem.removeClass(d+"over");if(m){return}l._getTansferFiles(i,function(p){l.trigger("drop",g.map(p,function(q){return new e(j,q)}))});return false},_getTansferFiles:function(q,p){var m=[],r=[],o,j,k,s,l,n,t;o=q.items;j=q.files;t=!!(o&&o[0].webkitGetAsEntry);for(l=0,n=j.length;l<n;l++){k=j[l];s=o&&o[l];if(t&&s.webkitGetAsEntry().isDirectory){r.push(this._traverseDirectoryTree(s.webkitGetAsEntry(),m))}else{m.push(k)}}f.when.apply(f,r).done(function(){if(!m.length){return}p(m)})},_traverseDirectoryTree:function(l,j){var i=f.Deferred(),k=this;if(l.isFile){l.file(function(m){j.push(m);i.resolve()})}else{if(l.isDirectory){l.createReader().readEntries(function(q){var n=q.length,o=[],m=[],p;for(p=0;p<n;p++){o.push(k._traverseDirectoryTree(q[p],m))}f.when.apply(f,o).then(function(){j.push.apply(j,m);i.resolve()},i.reject)})}}return i.promise()},destroy:function(){var i=this.elem;if(!i){return}i.off("dragenter",this.dragEnterHandler);i.off("dragover",this.dragOverHandler);i.off("dragleave",this.dragLeaveHandler);i.off("drop",this.dropHandler);if(this.options.disableGlobalDnd){g(document).off("dragover",this.dragOverHandler);g(document).off("drop",this.dropHandler)}}})});c("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(e,f,d){return f.register("FilePaste",{init:function(){var n=this.options,m=this.elem=n.container,j=".*",h,k,g,l;if(n.accept){h=[];for(k=0,g=n.accept.length;k<g;k++){l=n.accept[k].mimeTypes;l&&h.push(l)}if(h.length){j=h.join(",");j=j.replace(/,/g,"|").replace(/\*/g,".*")}}this.accept=j=new RegExp(j,"i");this.hander=e.bindFn(this._pasteHander,this);m.on("paste",this.hander)},_pasteHander:function(n){var o=[],k=this.getRuid(),j,m,h,l,g;n=n.originalEvent||n;j=n.clipboardData.items;for(l=0,g=j.length;l<g;l++){m=j[l];if(m.kind!=="file"||!(h=m.getAsFile())){continue}o.push(new d(k,h))}if(o.length){n.preventDefault();n.stopPropagation();this.trigger("paste",o)}},destroy:function(){this.elem.off("paste",this.hander)}})});c("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(d,f){var e=d.$;return f.register("FilePicker",{init:function(){var m=this.getRuntime().getContainer(),n=this,h=n.owner,g=n.options,p=this.label=e(document.createElement("label")),o=this.input=e(document.createElement("input")),k,j,l,q;o.attr("type","file");o.attr("name",g.name);o.addClass("webuploader-element-invisible");p.on("click",function(){o.trigger("click");h.trigger("dialogopen")});p.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"});if(g.multiple){o.attr("multiple","multiple")}if(g.accept&&g.accept.length>0){k=[];for(j=0,l=g.accept.length;j<l;j++){k.push(g.accept[j].mimeTypes)}o.attr("accept",k.join(","))}m.append(o);m.append(p);q=function(i){h.trigger(i.type)};o.on("change",function(r){var i=arguments.callee,s;n.files=r.target.files;s=this.cloneNode(true);s.value=null;this.parentNode.replaceChild(s,this);o.off();o=e(s).on("change",i).on("mouseenter mouseleave",q);h.trigger("change")});p.on("mouseenter mouseleave",q)},getFiles:function(){return this.files},destroy:function(){this.input.off();this.label.off()}})});c("runtime/html5/util",["base"],function(f){var d=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL,g=f.noop,e=g;if(d){g=function(){return d.createObjectURL.apply(d,arguments)};e=function(){return d.revokeObjectURL.apply(d,arguments)}}return{createObjectURL:g,revokeObjectURL:e,dataURL2Blob:function(h){var m,o,l,j,k,n;n=h.split(",");if(~n[0].indexOf("base64")){m=atob(n[1])}else{m=decodeURIComponent(n[1])}l=new ArrayBuffer(m.length);o=new Uint8Array(l);for(j=0;j<m.length;j++){o[j]=m.charCodeAt(j)}k=n[0].split(":")[1].split(";")[0];return this.arrayBufferToBlob(l,k)},dataURL2ArrayBuffer:function(h){var k,m,j,l;l=h.split(",");if(~l[0].indexOf("base64")){k=atob(l[1])}else{k=decodeURIComponent(l[1])}m=new Uint8Array(k.length);for(j=0;j<k.length;j++){m[j]=k.charCodeAt(j)}return m.buffer},arrayBufferToBlob:function(j,i){var h=a.BlobBuilder||a.WebKitBlobBuilder,k;if(h){k=new h();k.append(j);return k.getBlob(i)}return new Blob([j],i?{type:i}:{})},canvasToDataUrl:function(h,i,j){return h.toDataURL(i,j/100)},parseMeta:function(h,i){i(false,{})},updateImageHead:function(h){return h}}});c("runtime/html5/imagemeta",["runtime/html5/util"],function(e){var d;d={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(h,f){var i=this,g=new FileReader();g.onload=function(){f(false,i._parse(this.result));g=g.onload=g.onerror=null};g.onerror=function(j){f(j.message);g=g.onload=g.onerror=null};h=h.slice(0,i.maxMetaDataSize);g.readAsArrayBuffer(h.getSource())},_parse:function(h,p){if(h.byteLength<6){return}var m=new DataView(h),j=2,k=m.byteLength-4,n=j,o={},f,g,q,l;if(m.getUint16(0)===65496){while(j<k){f=m.getUint16(j);if(f>=65504&&f<=65519||f===65534){g=m.getUint16(j+2)+2;if(j+g>m.byteLength){break}q=d.parsers[f];if(!p&&q){for(l=0;l<q.length;l+=1){q[l].call(d,m,j,g,o)}}j+=g;n=j}else{break}}if(n>6){if(h.slice){o.imageHead=h.slice(2,n)}else{o.imageHead=new Uint8Array(h).subarray(2,n)}}}return o},updateImageHead:function(g,f){var i=this._parse(g,true),j,h,k;k=2;if(i.imageHead){k=2+i.imageHead.byteLength}if(g.slice){h=g.slice(k)}else{h=new Uint8Array(g).subarray(k)}j=new Uint8Array(f.byteLength+2+h.byteLength);j[0]=255;j[1]=216;j.set(new Uint8Array(f),2);j.set(new Uint8Array(h),f.byteLength+2);return j.buffer}};e.parseMeta=function(){return d.parse.apply(d,arguments)};e.updateImageHead=function(){return d.updateImageHead.apply(d,arguments)};return d});c("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(f,e){var d={};d.ExifMap=function(){return this};d.ExifMap.prototype.map={Orientation:274};d.ExifMap.prototype.get=function(g){return this[g]||this[this.map[g]]};d.exifTagTypes={1:{getValue:function(h,g){return h.getUint8(g)},size:1},2:{getValue:function(h,g){return String.fromCharCode(h.getUint8(g))},size:1,ascii:true},3:{getValue:function(i,g,h){return i.getUint16(g,h)},size:2},4:{getValue:function(i,g,h){return i.getUint32(g,h)},size:4},5:{getValue:function(i,g,h){return i.getUint32(g,h)/i.getUint32(g+4,h)},size:8},9:{getValue:function(i,g,h){return i.getInt32(g,h)},size:4},10:{getValue:function(i,g,h){return i.getInt32(g,h)/i.getInt32(g+4,h)},size:8}};d.exifTagTypes[7]=d.exifTagTypes[1];d.getExifValue=function(q,t,h,p,l,g){var s=d.exifTagTypes[p],m,j,r,k,o,n;if(!s){f.log("Invalid Exif data: Invalid tag type.");return}m=s.size*l;j=m>4?t+q.getUint32(h+8,g):(h+8);if(j+m>q.byteLength){f.log("Invalid Exif data: Invalid data offset.");return}if(l===1){return s.getValue(q,j,g)}r=[];for(k=0;k<l;k+=1){r[k]=s.getValue(q,j+k*s.size,g)}if(s.ascii){o="";for(k=0;k<r.length;k+=1){n=r[k];if(n==="\u0000"){break}o+=n}return o}return r};d.parseExifTag=function(l,h,k,j,i){var g=l.getUint16(k,j);i.exif[g]=d.getExifValue(l,h,k,l.getUint16(k+2,j),l.getUint32(k+4,j),j)};d.parseExifTags=function(o,g,j,n,l){var m,k,h;if(j+6>o.byteLength){f.log("Invalid Exif data: Invalid directory offset.");return}m=o.getUint16(j,n);k=j+2+12*m;if(k+4>o.byteLength){f.log("Invalid Exif data: Invalid directory size.");return}for(h=0;h<m;h+=1){this.parseExifTag(o,g,j+2+12*h,n,l)}return o.getUint32(k,n)};d.parseExifData=function(m,l,h,j){var g=l+10,k,i;if(m.getUint32(l+4)!==1165519206){return}if(g+8>m.byteLength){f.log("Invalid Exif data: Invalid segment size.");return}if(m.getUint16(l+8)!==0){f.log("Invalid Exif data: Missing byte alignment offset.");return}switch(m.getUint16(g)){case 18761:k=true;break;case 19789:k=false;break;default:f.log("Invalid Exif data: Invalid byte alignment marker.");return}if(m.getUint16(g+2,k)!==42){f.log("Invalid Exif data: Missing TIFF marker.");return}i=m.getUint32(g+4,k);j.exif=new d.ExifMap();i=d.parseExifTags(m,g,g+i,k,j)};e.parsers[65505].push(d.parseExifData);return d});c("runtime/html5/jpegencoder",[],function(e,f,d){function g(s){var v=this;var z=Math.round;var r=Math.floor;var V=new Array(64);var R=new Array(64);var k=new Array(64);var ag=new Array(64);var B;var o;var N;var aa;var u=new Array(65535);var t=new Array(65535);var W=new Array(64);var Z=new Array(64);var q=[];var A=0;var h=7;var H=new Array(64);var m=new Array(64);var ab=new Array(64);var l=new Array(256);var J=new Array(2048);var E;var p=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];var n=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];var j=[0,1,2,3,4,5,6,7,8,9,10,11];var D=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125];var L=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250];var C=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];var af=[0,1,2,3,4,5,6,7,8,9,10,11];var Q=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119];var I=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function T(an){var am=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var al=0;al<64;al++){var aq=r((am[al]*an+50)/100);if(aq<1){aq=1}else{if(aq>255){aq=255}}V[p[al]]=aq}var ao=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(var ak=0;ak<64;ak++){var ap=r((ao[ak]*an+50)/100);if(ap<1){ap=1}else{if(ap>255){ap=255}}R[p[ak]]=ap}var aj=[1,1.387039845,1.306562965,1.175875602,1,0.785694958,0.5411961,0.275899379];var ai=0;for(var ar=0;ar<8;ar++){for(var ah=0;ah<8;ah++){k[ai]=(1/(V[p[ai]]*aj[ar]*aj[ah]*8));ag[ai]=(1/(R[p[ai]]*aj[ar]*aj[ah]*8));ai++}}}function x(al,ah){var ak=0;var an=0;var am=new Array();for(var ai=1;ai<=16;ai++){for(var aj=1;aj<=al[ai];aj++){am[ah[an]]=[];am[ah[an]][0]=ak;am[ah[an]][1]=ai;an++;ak++}ak*=2}return am}function ad(){B=x(n,j);o=x(C,af);N=x(D,L);aa=x(Q,I)}function G(){var aj=1;var ai=2;for(var ah=1;ah<=15;ah++){for(var ak=aj;ak<ai;ak++){t[32767+ak]=ah;u[32767+ak]=[];u[32767+ak][1]=ah;u[32767+ak][0]=ak}for(var al=-(ai-1);al<=-aj;al++){t[32767+al]=ah;u[32767+al]=[];u[32767+al][1]=ah;u[32767+al][0]=ai-1+al}aj<<=1;ai<<=1}}function ac(){for(var ah=0;ah<256;ah++){J[ah]=19595*ah;J[(ah+256)>>0]=38470*ah;J[(ah+512)>>0]=7471*ah+32768;J[(ah+768)>>0]=-11059*ah;J[(ah+1024)>>0]=-21709*ah;J[(ah+1280)>>0]=32768*ah+8421375;J[(ah+1536)>>0]=-27439*ah;J[(ah+1792)>>0]=-5329*ah}}function ae(ah){var aj=ah[0];var ai=ah[1]-1;while(ai>=0){if(aj&(1<<ai)){A|=(1<<h)}ai--;h--;if(h<0){if(A==255){M(255);M(0)}else{M(A)}h=7;A=0}}}function M(ah){q.push(l[ah])}function w(ah){M((ah>>8)&255);M((ah)&255)}function U(a6,ax){var aS,aR,aQ,aP,aO,aK,aJ,aI;var aU=0;var aY;var ay=8;var ap=64;for(aY=0;aY<ay;++aY){aS=a6[aU];aR=a6[aU+1];aQ=a6[aU+2];aP=a6[aU+3];aO=a6[aU+4];aK=a6[aU+5];aJ=a6[aU+6];aI=a6[aU+7];var a5=aS+aI;var aV=aS-aI;var a4=aR+aJ;var aW=aR-aJ;var a1=aQ+aK;var aX=aQ-aK;var a0=aP+aO;var aZ=aP-aO;var av=a5+a0;var ar=a5-a0;var au=a4+a1;var at=a4-a1;a6[aU]=av+au;a6[aU+4]=av-au;var aE=(at+ar)*0.707106781;a6[aU+2]=ar+aE;a6[aU+6]=ar-aE;av=aZ+aX;au=aX+aW;at=aW+aV;var aA=(av-at)*0.382683433;var aD=0.5411961*av+aA;var aB=1.306562965*at+aA;var aC=au*0.707106781;var ao=aV+aC;var an=aV-aC;a6[aU+5]=an+aD;a6[aU+3]=an-aD;a6[aU+1]=ao+aB;a6[aU+7]=ao-aB;aU+=8}aU=0;for(aY=0;aY<ay;++aY){aS=a6[aU];aR=a6[aU+8];aQ=a6[aU+16];aP=a6[aU+24];aO=a6[aU+32];aK=a6[aU+40];aJ=a6[aU+48];aI=a6[aU+56];var az=aS+aI;var aq=aS-aI;var aG=aR+aJ;var al=aR-aJ;var aN=aQ+aK;var aj=aQ-aK;var a3=aP+aO;var ah=aP-aO;var aw=az+a3;var a2=az-a3;var aF=aG+aN;var aM=aG-aN;a6[aU]=aw+aF;a6[aU+32]=aw-aF;var am=(aM+a2)*0.707106781;a6[aU+16]=a2+am;a6[aU+48]=a2-am;aw=ah+aj;aF=aj+al;aM=al+aq;var aT=(aw-aM)*0.382683433;var ak=0.5411961*aw+aT;var a8=1.306562965*aM+aT;var ai=aF*0.707106781;var a7=aq+ai;var aH=aq-ai;a6[aU+40]=aH+ak;a6[aU+24]=aH-ak;a6[aU+8]=a7+a8;a6[aU+56]=a7-a8;aU++}var aL;for(aY=0;aY<ap;++aY){aL=a6[aY]*ax[aY];W[aY]=(aL>0)?((aL+0.5)|0):((aL-0.5)|0)}return W}function i(){w(65504);w(16);M(74);M(70);M(73);M(70);M(0);M(1);M(1);M(0);w(1);w(1);M(0);M(0)}function y(ah,ai){w(65472);w(17);M(8);w(ai);w(ah);M(3);M(1);M(17);M(0);M(2);M(17);M(1);M(3);M(17);M(1)}function K(){w(65499);w(132);M(0);for(var ai=0;ai<64;ai++){M(V[ai])}M(1);for(var ah=0;ah<64;ah++){M(R[ah])}}function O(){w(65476);w(418);M(0);for(var al=0;al<16;al++){M(n[al+1])}for(var ak=0;ak<=11;ak++){M(j[ak])}M(16);for(var aj=0;aj<16;aj++){M(D[aj+1])}for(var ai=0;ai<=161;ai++){M(L[ai])}M(1);for(var ah=0;ah<16;ah++){M(C[ah+1])}for(var ao=0;ao<=11;ao++){M(af[ao])}M(17);for(var an=0;an<16;an++){M(Q[an+1])}for(var am=0;am<=161;am++){M(I[am])}}function P(){w(65498);w(12);M(3);M(1);M(0);M(2);M(17);M(3);M(17);M(0);M(63);M(0)}function S(ak,ah,at,aA,ax){var an=ax[0];var ai=ax[240];var aj;var az=16;var ap=63;var ao=64;var ay=U(ak,ah);for(var au=0;au<ao;++au){Z[p[au]]=ay[au]}var av=Z[0]-at;at=Z[0];if(av==0){ae(aA[0])}else{aj=32767+av;ae(aA[t[aj]]);ae(u[aj])}var al=63;for(;(al>0)&&(Z[al]==0);al--){}if(al==0){ae(an);return at}var aw=1;var aB;while(aw<=al){var ar=aw;for(;(Z[aw]==0)&&(aw<=al);++aw){}var aq=aw-ar;if(aq>=az){aB=aq>>4;for(var am=1;am<=aB;++am){ae(ai)}aq=aq&15}aj=32767+Z[aw];ae(ax[(aq<<4)+t[aj]]);ae(u[aj]);aw++}if(al!=ap){ae(an)}return at}function F(){var ai=String.fromCharCode;for(var ah=0;ah<256;ah++){l[ah]=ai(ah)}}this.encode=function(at,ap){if(ap){Y(ap)}q=new Array();A=0;h=7;w(65496);i();K();y(at.width,at.height);O();P();var aq=0;var aw=0;var au=0;A=0;h=7;this.encode.displayName="_encode_";var ay=at.data;var ax=at.width;var aD=at.height;var aB=ax*4;var ao=ax*3;var an,am=0;var ar,aA,aC;var ah,av,ai,al,ak;while(am<aD){an=0;while(an<aB){ah=aB*am+an;av=ah;ai=-1;al=0;for(ak=0;ak<64;ak++){al=ak>>3;ai=(ak&7)*4;av=ah+(al*aB)+ai;if(am+al>=aD){av-=(aB*(am+1+al-aD))}if(an+ai>=aB){av-=((an+ai)-aB+4)}ar=ay[av++];aA=ay[av++];aC=ay[av++];H[ak]=((J[ar]+J[(aA+256)>>0]+J[(aC+512)>>0])>>16)-128;m[ak]=((J[(ar+768)>>0]+J[(aA+1024)>>0]+J[(aC+1280)>>0])>>16)-128;ab[ak]=((J[(ar+1280)>>0]+J[(aA+1536)>>0]+J[(aC+1792)>>0])>>16)-128}aq=S(H,k,aq,B,N);aw=S(m,ag,aw,o,aa);au=S(ab,ag,au,o,aa);an+=32}am+=8}if(h>=0){var az=[];az[1]=h+1;az[0]=(1<<(h+1))-1;ae(az)}w(65497);var aj="data:image/jpeg;base64,"+btoa(q.join(""));q=[];return aj};function Y(ai){if(ai<=0){ai=1}if(ai>100){ai=100}if(E==ai){return}var ah=0;if(ai<50){ah=Math.floor(5000/ai)}else{ah=Math.floor(200-ai*2)}T(ah);E=ai}function X(){if(!s){s=50}F();ad();G();ac();Y(s)}X()}g.encode=function(i,j){var h=new g(j);return h.encode(i)};return g});c("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(h,d,f){var g=h.canvasToDataUrl,e;h.canvasToDataUrl=function(k,m,p){var j,i,l,n,o;if(!f.os.android){return g.apply(null,arguments)}if(m==="image/jpeg"&&typeof e==="undefined"){n=g.apply(null,arguments);o=n.split(",");if(~o[0].indexOf("base64")){n=atob(o[1])}else{n=decodeURIComponent(o[1])}n=n.substring(0,2);e=n.charCodeAt(0)===255&&n.charCodeAt(1)===216}if(m==="image/jpeg"&&!e){i=k.width;l=k.height;j=k.getContext("2d");return d.encode(j.getImageData(0,0,i,l),p)}return g.apply(null,arguments)}});c("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(d,g,e){var f="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";return g.register("Image",{modified:false,init:function(){var i=this,h=new Image();h.onload=function(){i._info={type:i.type,width:this.width,height:this.height};if(!i._metas&&"image/jpeg"===i.type){e.parseMeta(i._blob,function(k,j){i._metas=j;i.owner.trigger("load")})}else{i.owner.trigger("load")}};h.onerror=function(){i.owner.trigger("error")};i._img=h},loadFromBlob:function(i){var j=this,h=j._img;j._blob=i;j.type=i.type;h.src=e.createObjectURL(i.getSource());j.owner.once("load",function(){e.revokeObjectURL(h.src)})},resize:function(i,j){var h=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,h,i,j);this._blob=null;this.modified=true;this.owner.trigger("complete","resize")},crop:function(p,o,q,l,t){var m=this._canvas||(this._canvas=document.createElement("canvas")),i=this.options,k=this._img,j=k.naturalWidth,r=k.naturalHeight,n=this.getOrientation();t=t||1;m.width=q;m.height=l;i.preserveHeaders||this._rotate2Orientaion(m,n);this._renderImageToCanvas(m,k,-p,-o,j*t,r*t);this._blob=null;this.modified=true;this.owner.trigger("complete","crop")},getAsBlob:function(j){var h=this._blob,k=this.options,i;j=j||this.type;if(this.modified||this.type!==j){i=this._canvas;if(j==="image/jpeg"){h=e.canvasToDataUrl(i,j,k.quality);if(k.preserveHeaders&&this._metas&&this._metas.imageHead){h=e.dataURL2ArrayBuffer(h);h=e.updateImageHead(h,this._metas.imageHead);h=e.arrayBufferToBlob(h,j);return h}}else{h=e.canvasToDataUrl(i,j)}h=e.dataURL2Blob(h)}return h},getAsDataUrl:function(h){var i=this.options;h=h||this.type;if(h==="image/jpeg"){return e.canvasToDataUrl(this._canvas,h,i.quality)}else{return this._canvas.toDataURL(h)}},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(h){if(h){this._info=h;return this}return this._info},meta:function(h){if(h){this._metas=h;return this}return this._metas},destroy:function(){var h=this._canvas;this._img.onload=null;if(h){h.getContext("2d").clearRect(0,0,h.width,h.height);h.width=h.height=0;this._canvas=null}this._img.src=f;this._img=this._blob=null},_resize:function(l,o,j,t){var i=this.options,n=l.width,u=l.height,p=this.getOrientation(),k,s,m,r,q;if(~[5,6,7,8].indexOf(p)){j^=t;t^=j;j^=t}k=Math[i.crop?"max":"min"](j/n,t/u);i.allowMagnify||(k=Math.min(1,k));s=n*k;m=u*k;if(i.crop){o.width=j;o.height=t}else{o.width=s;o.height=m}r=(o.width-s)/2;q=(o.height-m)/2;i.preserveHeaders||this._rotate2Orientaion(o,p);this._renderImageToCanvas(o,l,r,q,s,m)},_rotate2Orientaion:function(i,k){var j=i.width,l=i.height,h=i.getContext("2d");switch(k){case 5:case 6:case 7:case 8:i.width=l;i.height=j;break}switch(k){case 2:h.translate(j,0);h.scale(-1,1);break;case 3:h.translate(j,l);h.rotate(Math.PI);break;case 4:h.translate(0,l);h.scale(1,-1);break;case 5:h.rotate(0.5*Math.PI);h.scale(1,-1);break;case 6:h.rotate(0.5*Math.PI);h.translate(0,-l);break;case 7:h.rotate(0.5*Math.PI);h.translate(j,-l);h.scale(-1,1);break;case 8:h.rotate(-0.5*Math.PI);h.translate(-j,0);break}},_renderImageToCanvas:(function(){if(!d.os.ios){return function(l){var k=d.slice(arguments,1),j=l.getContext("2d");j.drawImage.apply(j,k)}}function i(m,j,t){var n=document.createElement("canvas"),s=n.getContext("2d"),q=0,o=t,r=t,l,k,p;n.width=1;n.height=t;s.drawImage(m,0,0);l=s.getImageData(0,0,1,t).data;while(r>q){k=l[(r-1)*4+3];if(k===0){o=r}else{q=r}r=(o+q)>>1}p=(r/t);return(p===0)?1:p}if(d.os.ios>=7){return function(n,l,p,o,q,m){var k=l.naturalWidth,r=l.naturalHeight,j=i(l,k,r);return n.getContext("2d").drawImage(l,0,0,k*j,r*j,p,o,q,m)}}function h(l){var k=l.naturalWidth,n=l.naturalHeight,m,j;if(k*n>1024*1024){m=document.createElement("canvas");m.width=m.height=1;j=m.getContext("2d");j.drawImage(l,-k+1,0);return j.getImageData(0,0,1,1).data[3]===0}else{return false}}return function(n,F,p,o,z,E){var l=F.naturalWidth,u=F.naturalHeight,A=n.getContext("2d"),q=h(F),j=this.type==="image/jpeg",D=1024,v=0,r=0,k,m,C,t,B,w,s;if(q){l/=2;u/=2}A.save();k=document.createElement("canvas");k.width=k.height=D;m=k.getContext("2d");C=j?i(F,l,u):1;t=Math.ceil(D*z/l);B=Math.ceil(D*E/u/C);while(v<u){w=0;s=0;while(w<l){m.clearRect(0,0,D,D);m.drawImage(F,-w,-v);A.drawImage(k,0,0,D,D,p+s,o+r,t,B);w+=D;s+=t}v+=D;r+=B}A.restore();k=m=null}})()})});c("runtime/html5/transport",["base","runtime/html5/runtime"],function(d,g){var e=d.noop,f=d.$;return g.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var h=this.owner,k=this.options,n=this._initAjax(),j=h._blob,o=k.server,m,l,i;if(k.sendAsBinary){o+=(/\?/.test(o)?"&":"?")+f.param(h._formData);l=j.getSource()}else{m=new FormData();f.each(h._formData,function(q,p){m.append(q,p)});m.append(k.fileVal,j.getSource(),k.filename||h._formData.name||"")}if(k.withCredentials&&"withCredentials" in n){n.open(k.method,o,true);n.withCredentials=true}else{n.open(k.method,o)}this._setRequestHeader(n,k.headers);if(l){n.overrideMimeType&&n.overrideMimeType("application/octet-stream");if(d.os.android){i=new FileReader();i.onload=function(){n.send(this.result);i=i.onload=null};i.readAsArrayBuffer(l)}else{n.send(l)}}else{n.send(m)}},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var h=this._xhr;if(h){h.upload.onprogress=e;h.onreadystatechange=e;h.abort();this._xhr=h=null}},destroy:function(){this.abort()},_initAjax:function(){var i=this,j=new XMLHttpRequest(),h=this.options;if(h.withCredentials&&!("withCredentials" in j)&&typeof XDomainRequest!=="undefined"){j=new XDomainRequest()}j.upload.onprogress=function(l){var k=0;if(l.lengthComputable){k=l.loaded/l.total}return i.trigger("progress",k)};j.onreadystatechange=function(){if(j.readyState!==4){return}j.upload.onprogress=e;j.onreadystatechange=e;i._xhr=null;i._status=j.status;if(j.status>=200&&j.status<300){i._response=j.responseText;return i.trigger("load")}else{if(j.status>=500&&j.status<600){i._response=j.responseText;return i.trigger("error","server")}}return i.trigger("error",i._status?"http":"abort")};i._xhr=j;return j},_setRequestHeader:function(i,h){f.each(h,function(j,k){i.setRequestHeader(j,k)})},_parseJson:function(j){var i;try{i=JSON.parse(j)}catch(h){i={}}return i}})});c("runtime/html5/md5",["runtime/html5/runtime"],function(r){var h=function(v,u){return(v+u)&4294967295},q=function(A,w,v,u,z,y){w=h(h(w,A),h(u,y));return h((w<<z)|(w>>>(32-z)),v)},d=function(w,v,B,A,u,z,y){return q((v&B)|((~v)&A),w,v,u,z,y)},m=function(w,v,B,A,u,z,y){return q((v&A)|(B&(~A)),w,v,u,z,y)},g=function(w,v,B,A,u,z,y){return q(v^B^A,w,v,u,z,y)},t=function(w,v,B,A,u,z,y){return q(B^(v|(~A)),w,v,u,z,y)},f=function(v,y){var w=v[0],u=v[1],A=v[2],z=v[3];w=d(w,u,A,z,y[0],7,-680876936);z=d(z,w,u,A,y[1],12,-389564586);A=d(A,z,w,u,y[2],17,606105819);u=d(u,A,z,w,y[3],22,-1044525330);w=d(w,u,A,z,y[4],7,-176418897);z=d(z,w,u,A,y[5],12,1200080426);A=d(A,z,w,u,y[6],17,-1473231341);u=d(u,A,z,w,y[7],22,-45705983);w=d(w,u,A,z,y[8],7,1770035416);z=d(z,w,u,A,y[9],12,-1958414417);A=d(A,z,w,u,y[10],17,-42063);u=d(u,A,z,w,y[11],22,-1990404162);w=d(w,u,A,z,y[12],7,1804603682);z=d(z,w,u,A,y[13],12,-40341101);A=d(A,z,w,u,y[14],17,-1502002290);u=d(u,A,z,w,y[15],22,1236535329);w=m(w,u,A,z,y[1],5,-165796510);z=m(z,w,u,A,y[6],9,-1069501632);A=m(A,z,w,u,y[11],14,643717713);u=m(u,A,z,w,y[0],20,-373897302);w=m(w,u,A,z,y[5],5,-701558691);z=m(z,w,u,A,y[10],9,38016083);A=m(A,z,w,u,y[15],14,-660478335);u=m(u,A,z,w,y[4],20,-405537848);w=m(w,u,A,z,y[9],5,568446438);z=m(z,w,u,A,y[14],9,-1019803690);A=m(A,z,w,u,y[3],14,-187363961);u=m(u,A,z,w,y[8],20,1163531501);w=m(w,u,A,z,y[13],5,-1444681467);z=m(z,w,u,A,y[2],9,-51403784);A=m(A,z,w,u,y[7],14,1735328473);u=m(u,A,z,w,y[12],20,-1926607734);w=g(w,u,A,z,y[5],4,-378558);z=g(z,w,u,A,y[8],11,-2022574463);A=g(A,z,w,u,y[11],16,1839030562);u=g(u,A,z,w,y[14],23,-35309556);w=g(w,u,A,z,y[1],4,-1530992060);z=g(z,w,u,A,y[4],11,1272893353);A=g(A,z,w,u,y[7],16,-155497632);u=g(u,A,z,w,y[10],23,-1094730640);w=g(w,u,A,z,y[13],4,681279174);z=g(z,w,u,A,y[0],11,-358537222);A=g(A,z,w,u,y[3],16,-722521979);u=g(u,A,z,w,y[6],23,76029189);w=g(w,u,A,z,y[9],4,-640364487);z=g(z,w,u,A,y[12],11,-421815835);A=g(A,z,w,u,y[15],16,530742520);u=g(u,A,z,w,y[2],23,-995338651);w=t(w,u,A,z,y[0],6,-198630844);z=t(z,w,u,A,y[7],10,1126891415);A=t(A,z,w,u,y[14],15,-1416354905);u=t(u,A,z,w,y[5],21,-57434055);w=t(w,u,A,z,y[12],6,1700485571);z=t(z,w,u,A,y[3],10,-1894986606);A=t(A,z,w,u,y[10],15,-1051523);u=t(u,A,z,w,y[1],21,-2054922799);w=t(w,u,A,z,y[8],6,1873313359);z=t(z,w,u,A,y[15],10,-30611744);A=t(A,z,w,u,y[6],15,-1560198380);u=t(u,A,z,w,y[13],21,1309151649);w=t(w,u,A,z,y[4],6,-145523070);z=t(z,w,u,A,y[11],10,-1120210379);A=t(A,z,w,u,y[2],15,718787259);u=t(u,A,z,w,y[9],21,-343485551);v[0]=h(w,v[0]);v[1]=h(u,v[1]);v[2]=h(A,v[2]);v[3]=h(z,v[3])},o=function(v){var w=[],u;for(u=0;u<64;u+=4){w[u>>2]=v.charCodeAt(u)+(v.charCodeAt(u+1)<<8)+(v.charCodeAt(u+2)<<16)+(v.charCodeAt(u+3)<<24)}return w},p=function(u){var w=[],v;for(v=0;v<64;v+=4){w[v>>2]=u[v]+(u[v+1]<<8)+(u[v+2]<<16)+(u[v+3]<<24)}return w},n=function(C){var v=C.length,u=[1732584193,-271733879,-1732584194,271733878],y,z,A,x,B,w;for(y=64;y<=v;y+=64){f(u,o(C.substring(y-64,y)))}C=C.substring(y-64);z=C.length;A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(y=0;y<z;y+=1){A[y>>2]|=C.charCodeAt(y)<<((y%4)<<3)}A[y>>2]|=128<<((y%4)<<3);if(y>55){f(u,A);for(y=0;y<16;y+=1){A[y]=0}}x=v*8;x=x.toString(16).match(/(.*?)(.{0,8})$/);B=parseInt(x[2],16);w=parseInt(x[1],16)||0;A[14]=B;A[15]=w;f(u,A);return u},s=function(C){var v=C.length,u=[1732584193,-271733879,-1732584194,271733878],y,z,A,x,B,w;for(y=64;y<=v;y+=64){f(u,p(C.subarray(y-64,y)))}C=(y-64)<v?C.subarray(y-64):new Uint8Array(0);z=C.length;A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(y=0;y<z;y+=1){A[y>>2]|=C[y]<<((y%4)<<3)}A[y>>2]|=128<<((y%4)<<3);if(y>55){f(u,A);for(y=0;y<16;y+=1){A[y]=0}}x=v*8;x=x.toString(16).match(/(.*?)(.{0,8})$/);B=parseInt(x[2],16);w=parseInt(x[1],16)||0;A[14]=B;A[15]=w;f(u,A);return u},l=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],j=function(w){var v="",u;for(u=0;u<4;u+=1){v+=l[(w>>(u*8+4))&15]+l[(w>>(u*8))&15]}return v},e=function(u){var v;for(v=0;v<u.length;v+=1){u[v]=j(u[v])}return u.join("")},k=function(u){return e(n(u))},i=function(){this.reset()};if(k("hello")!=="5d41402abc4b2a76b9719d911017c592"){h=function(u,z){var w=(u&65535)+(z&65535),v=(u>>16)+(z>>16)+(w>>16);return(v<<16)|(w&65535)}}i.prototype.append=function(u){if(/[\u0080-\uFFFF]/.test(u)){u=unescape(encodeURIComponent(u))}this.appendBinary(u);return this};i.prototype.appendBinary=function(v){this._buff+=v;this._length+=v.length;var u=this._buff.length,w;for(w=64;w<=u;w+=64){f(this._state,o(this._buff.substring(w-64,w)))}this._buff=this._buff.substr(w-64);return this};i.prototype.end=function(x){var z=this._buff,u=z.length,y,w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],v;for(y=0;y<u;y+=1){w[y>>2]|=z.charCodeAt(y)<<((y%4)<<3)}this._finish(w,u);v=!!x?this._state:e(this._state);this.reset();return v};i.prototype._finish=function(w,u){var y=u,x,z,v;w[y>>2]|=128<<((y%4)<<3);if(y>55){f(this._state,w);for(y=0;y<16;y+=1){w[y]=0}}x=this._length*8;x=x.toString(16).match(/(.*?)(.{0,8})$/);z=parseInt(x[2],16);v=parseInt(x[1],16)||0;w[14]=z;w[15]=v;f(this._state,w)};i.prototype.reset=function(){this._buff="";this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};i.prototype.destroy=function(){delete this._state;delete this._buff;delete this._length};i.hash=function(w,u){if(/[\u0080-\uFFFF]/.test(w)){w=unescape(encodeURIComponent(w))}var v=n(w);return !!u?v:e(v)};i.hashBinary=function(v,u){var w=n(v);return !!u?w:e(w)};i.ArrayBuffer=function(){this.reset()};i.ArrayBuffer.prototype.append=function(u){var x=this._concatArrayBuffer(this._buff,u),v=x.length,w;this._length+=u.byteLength;for(w=64;w<=v;w+=64){f(this._state,p(x.subarray(w-64,w)))}this._buff=(w-64)<v?x.subarray(w-64):new Uint8Array(0);return this};i.ArrayBuffer.prototype.end=function(x){var z=this._buff,u=z.length,w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y,v;for(y=0;y<u;y+=1){w[y>>2]|=z[y]<<((y%4)<<3)}this._finish(w,u);v=!!x?this._state:e(this._state);this.reset();return v};i.ArrayBuffer.prototype._finish=i.prototype._finish;i.ArrayBuffer.prototype.reset=function(){this._buff=new Uint8Array(0);this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};i.ArrayBuffer.prototype.destroy=i.prototype.destroy;i.ArrayBuffer.prototype._concatArrayBuffer=function(x,u){var w=x.length,v=new Uint8Array(w+u.byteLength);v.set(x);v.set(new Uint8Array(u),w);return v};i.ArrayBuffer.hash=function(u,v){var w=s(new Uint8Array(u));return !!v?w:e(w)};return r.register("Md5",{init:function(){},loadFromBlob:function(x){var u=x.getSource(),y=2*1024*1024,w=Math.ceil(u.size/y),D=0,v=this.owner,A=new i.ArrayBuffer(),C=this,E=u.mozSlice||u.webkitSlice||u.slice,B,z;z=new FileReader();B=function(){var G,F;G=D*y;F=Math.min(G+y,u.size);z.onload=function(H){A.append(H.target.result);v.trigger("progress",{total:x.size,loaded:F})};z.onloadend=function(){z.onloadend=z.onload=null;if(++D<w){setTimeout(B,1)}else{setTimeout(function(){v.trigger("load");C.result=A.end();B=x=u=A=null;v.trigger("complete")},50)}};z.readAsArrayBuffer(E.call(u,G,F))};B()},getResult:function(){return this.result}})});c("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(g,f,j){var i=g.$,h="flash",d={};function e(){var l;try{l=navigator.plugins["Shockwave Flash"];l=l.description}catch(m){try{l=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(n){l="0.0"}}l=l.match(/\d+/g);return parseFloat(l[0]+"."+l[1],10)}function k(){var o={},m={},n=this.destroy,q=this,l=g.guid("webuploader_");f.apply(q,arguments);q.type=h;q.exec=function(s,v){var w=this,u=w.uid,t=g.slice(arguments,2),r;m[u]=w;if(d[s]){if(!o[u]){o[u]=new d[s](w,q)}r=o[u];if(r[v]){return r[v].apply(r,t)}}return q.flashExec.apply(w,arguments)};function p(r,v){var t=r.type||r,u,s;u=t.split("::");s=u[0];t=u[1];if(t==="Ready"&&s===q.uid){q.trigger("ready")}else{if(m[s]){m[s].trigger(t.toLowerCase(),r,v)}}}a[l]=function(){var r=arguments;setTimeout(function(){p.apply(null,r)},1)};this.jsreciver=l;this.destroy=function(){return n&&n.apply(this,arguments)};this.flashExec=function(r,u){var t=q.getFlash(),s=g.slice(arguments,2);return t.exec(this.uid,r,u,s)}}g.inherits(f,{constructor:k,init:function(){var n=this.getContainer(),m=this.options,l;n.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});l='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+m.swf+'" ';if(g.browser.ie){l+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}l+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+m.swf+'" /><param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';n.html(l)},getFlash:function(){if(this._flash){return this._flash}this._flash=i("#"+this.uid).get(0);return this._flash}});k.register=function(l,m){m=d[l]=g.inherits(j,i.extend({flashExec:function(){var n=this.owner,o=this.getRuntime();return o.flashExec.apply(n,arguments)}},m));return m};if(e()>=11.4){f.addRuntime(h,k)}return k});c("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(d,f){var e=d.$;return f.register("FilePicker",{init:function(j){var k=e.extend({},j),g,h;g=k.accept&&k.accept.length;for(h=0;h<g;h++){if(!k.accept[h].title){k.accept[h].title="Files"}}delete k.button;delete k.id;delete k.container;this.flashExec("FilePicker","init",k)},destroy:function(){this.flashExec("FilePicker","destroy")}})});c("runtime/flash/image",["runtime/flash/runtime"],function(d){return d.register("Image",{loadFromBlob:function(f){var e=this.owner;e.info()&&this.flashExec("Image","info",e.info());e.meta()&&this.flashExec("Image","meta",e.meta());this.flashExec("Image","loadFromBlob",f.uid)}})});c("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(e,g,d){var f=e.$;return g.register("Transport",{init:function(){this._status=0;this._response=null;this._responseJson=null},send:function(){var h=this.owner,j=this.options,l=this._initAjax(),i=h._blob,m=j.server,k;l.connectRuntime(i.ruid);if(j.sendAsBinary){m+=(/\?/.test(m)?"&":"?")+f.param(h._formData);k=i.uid}else{f.each(h._formData,function(o,n){l.exec("append",o,n)});l.exec("appendBlob",j.fileVal,i.uid,j.filename||h._formData.name||"")}this._setRequestHeader(l,j.headers);l.exec("send",{method:j.method,url:m,forceURLStream:j.forceURLStream,mimeType:"application/octet-stream"},k)},getStatus:function(){return this._status},getResponse:function(){return this._response||""},getResponseAsJson:function(){return this._responseJson},abort:function(){var h=this._xhr;if(h){h.exec("abort");h.destroy();this._xhr=h=null}},destroy:function(){this.abort()},_initAjax:function(){var h=this,i=new d("XMLHttpRequest");i.on("uploadprogress progress",function(k){var j=k.loaded/k.total;j=Math.min(1,Math.max(0,j));return h.trigger("progress",j)});i.on("load",function(){var l=i.exec("getStatus"),j=false,k="",m;i.off();h._xhr=null;if(l>=200&&l<300){j=true}else{if(l>=500&&l<600){j=true;k="server"}else{k="http"}}if(j){h._response=i.exec("getResponse");h._response=decodeURIComponent(h._response);m=function(n){try{if(a.JSON&&a.JSON.parse){return JSON.parse(n)}return new Function("return "+n).call()}catch(o){return{}}};h._responseJson=h._response?m(h._response):{}}i.destroy();i=null;return k?h.trigger("error",k):h.trigger("load")});i.on("error",function(){i.off();h._xhr=null;h.trigger("error","http")});h._xhr=i;return i},_setRequestHeader:function(i,h){f.each(h,function(j,k){i.exec("setRequestHeader",j,k)})}})});c("runtime/flash/blob",["runtime/flash/runtime","lib/blob"],function(d,e){return d.register("Blob",{slice:function(h,f){var g=this.flashExec("Blob","slice",h,f);return new e(g.uid,g)}})});c("runtime/flash/md5",["runtime/flash/runtime"],function(d){return d.register("Md5",{init:function(){},loadFromBlob:function(e){return this.flashExec("Md5","loadFromBlob",e.uid)}})});c("preset/all",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","widgets/md5","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/androidpatch","runtime/html5/image","runtime/html5/transport","runtime/html5/md5","runtime/flash/filepicker","runtime/flash/image","runtime/flash/transport","runtime/flash/blob","runtime/flash/md5"],function(d){return d});c("widgets/log",["base","uploader","widgets/widget"],function(f,j){var h=f.$,k=" http://static.tieba.baidu.com/tb/pms/img/st.gif??",d=(location.hostname||location.host||"protected").toLowerCase(),e=d&&/baidu/i.exec(d),g;if(!e){return}g={dv:3,master:"webuploader",online:/test/.exec(d)?0:1,module:"",product:d,type:0};function i(m){var o=h.extend({},g,m),l=k.replace(/^(.*)\?/,"$1"+h.param(o)),n=new Image();n.src=l}return j.register({name:"log",init:function(){var l=this.owner,n=0,m=0;l.on("error",function(o){i({type:2,c_error_code:o})}).on("uploadError",function(o,p){i({type:2,c_error_code:"UPLOAD_ERROR",c_reason:""+p})}).on("uploadComplete",function(o){n++;m+=o.size}).on("uploadFinished",function(){i({c_count:n,c_size:m});n=m=0});i({c_usage:1})}})});c("webuploader",["preset/all","widgets/log"],function(d){return d});return b("webuploader")});